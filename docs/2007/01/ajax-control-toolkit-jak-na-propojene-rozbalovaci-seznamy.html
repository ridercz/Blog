<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AJAX Control Toolkit: Jak na propojené rozbalovací seznamy? | ALTAIR.blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="cs-CZ" />
    <link rel="canonical" href="https://www.altair.blog/2007/01/ajax-control-toolkit-jak-na-propojene-rozbalovaci-seznamy" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/6.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="/content/styles.min.css?sha=86D6BE2BECADA8998ACB7999F797DEF1103C76B2" />
    <link rel="stylesheet" type="text/css" href="/content/fa-6.5.1/css/all.min.css" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed.rss" title="RSS (všechny články)" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed-internal.rss" title="RSS (pouze místní články)" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed-external.rss" title="RSS (pouze odkazy)" />
    <link rel="shortcut icon" href="https://www.altair.blog/favicon.ico" />
    <link rel="icon" href="https://www.altair.blog/favicon.ico" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@ridercz" />
    <meta name="twitter:title" content="AJAX Control Toolkit: Jak na propojené rozbalovací seznamy?" />
    <meta name="twitter:description" content="Jeden z případů, kdy je technologie AJAX k nezaplacení, je výběr z rozsáhlého hodnot, které jsou na sobě závislé. Typicky výběr země a jí příslušejícího regionu (státu, kraje...). Právě na tomto příkladu si ukážeme využití prvku CascadingDropDown, který je součástí ASP.NET Ajax Control Toolkitu." />
    <meta name="twitter:image" content="https://www.altair.blog/content/images/preview-1200.jpg" />
    <meta property="article:published_time" content="2007-01-05T04:36:16.277+01:00" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="ALTAIR.blog" />
    <meta name="author" content="Michal Altair Valášek" />
    <meta name="title" property="og:title" content="AJAX Control Toolkit: Jak na propojené rozbalovací seznamy?" />
    <meta name="description" property="og:description" content="Jeden z případů, kdy je technologie AJAX k nezaplacení, je výběr z rozsáhlého hodnot, které jsou na sobě závislé. Typicky výběr země a jí příslušejícího regionu (státu, kraje...). Právě na tomto příkladu si ukážeme využití prvku CascadingDropDown, který je součástí ASP.NET Ajax Control Toolkitu." />
    <meta name="image" property="og:image" content="https://www.altair.blog/content/images/preview-1200.jpg" />
    <meta property="og:locale" content="cs_CZ" />
    <meta property="og:url" content="https://www.altair.blog/2007/01/ajax-control-toolkit-jak-na-propojene-rozbalovaci-seznamy" />
    <script>
      (function(f, a, t, h, o, m){
        a[h]=a[h]||function(){
          (a[h].q=a[h].q||[]).push(arguments)
        };
        o=f.createElement('script'),
        m=f.getElementsByTagName('script')[0];
        o.async=1; o.src=t; o.id='fathom-script';
        m.parentNode.insertBefore(o,m)
      })(document, window, '//stats.altair.blog/tracker.js', 'fathom');
      fathom('set', 'siteId', 'OBOTR');
      fathom('trackPageview');
    </script>
    <script src="/content/scripts/autocorrect.js?sha=3D24FB150C3151FFF3B9BFCA112E1A8B2F32B377" defer="defer" onload="typo.runAutoCorrector({number: false})">//</script>
    <meta name="robots" content="index, follow" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css" integrity="sha512-hasIneQUHlh06VNBe7f6ZcHmeRTLIaQWFd43YriJ0UND19bvYRauxthDg8E4eVNPm9bRUhr5JGeqH7FRFXQu5g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body>
    <header>
      <div>
        <a href="/">
          <img src="/content/images/logo_onblack.svg" alt="altair.blog" style="max-height:100px;max-width:80%" />
        </a>
      </div>
    </header>
    <nav>
      <ul>
        <li>
          <a href="https://www.rider.cz/" title="Autor: Michal Altair Valášek">
            <i class="fal fa-fw fa-user"> </i>
          </a>
        </li>
        <li>
          <a href="/archive" title="Archiv článků">
            <i class="fal fa-fw fa-archive"> </i>
          </a>
        </li>
        <li>
          <a href="/categories" title="Rubriky">
            <i class="fal fa-fw fa-tags"> </i>
          </a>
        </li>
        <li>
          <a href="/serials" title="Seriály">
            <i class="fal fa-fw fa-list-alt"> </i>
          </a>
        </li>
        <li>
          <a href="/search" title="Vyhledávání">
            <i class="fal fa-fw fa-search"> </i>
          </a>
        </li>
        <li>
          <a href="https://www.rider.cz/#contact" title="Kontakt">
            <i class="fal fa-fw fa-envelope"> </i>
          </a>
        </li>
        <li>
          <a href="https://facebook.com/rider.cz" title="Facebook">
            <i class="fab fa-fw fa-facebook"> </i>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/ridercz" title="Twitter">
            <i class="fab fa-twitter"> </i>
          </a>
        </li>
        <li>
          <a href="https://github.com/ridercz" title="Github">
            <i class="fab fa-fw fa-github"> </i>
          </a>
        </li>
        <li>
          <a href="https://ask.fm/ridercz" title="Ask.fm">
            <i class="fal fa-fw fa-question"> </i>
          </a>
        </li>
      </ul>
    </nav>
    <main>
      <h1>AJAX Control Toolkit: Jak na propojené rozbalovací seznamy?</h1>
      <aside class="article-info">
        <ul class="categories">
          <li>
            <a href="/categories/it" title="Rubrika">
              <i class="fal fa-tag"> </i>IT</a>
          </li>
        </ul>
        <div title="Autor">
          <a href="https://www.rider.cz/">Michal Altair Valášek </a>
          <i class="fal fa-fw fa-user">​</i>
        </div>
        <div title="Datum vydání">
          <time datetime="2007-01-05T04:36:16.277+01:00">5. ledna 2007 <i class="fal fa-fw fa-calendar-lines">​</i></time>
        </div>
      </aside>
      <section class="article-text">
         <p>Jeden z případů, kdy je technologie AJAX k nezaplacení, je výběr z rozsáhlého hodnot, které jsou na sobě závislé. Typicky výběr země a jí příslušejícího regionu (státu, kraje...). Právě na tomto příkladu si ukážeme využití prvku <code>CascadingDropDown</code>, který je součástí ASP.NET Ajax Control Toolkitu.</p><p><strong>Poznámka: </strong>Popisovaná technologie je stále ve vývoji a zde uvedený kód nemusí být kompatibilní s finální verzí. Veškerý text tohoto článku se vztahuje k <a href="http://ajax.asp.net/">ASP.NET Ajax 1.0 RC</a> a <a href="http://www.codeplex.com/AtlasControlToolkit/Release/ProjectReleases.aspx?ReleaseId=1283">AJAX Control Toolkit release 61214 Production</a>.</p><h2>Jak funguje AJAX v ASP.NET</h2><p>Technologie AJAX je obecně založena na tom, že klientský skript (JavaScript) si posílá se serverem přes HTTP data formátovaná v XML a podle nich dynamicky modifikuje zobrazenou stránku. Microsoftí implementace využívá toho, že XML data posílaná přes HTTP jsou vlastně webové služby (web services). Javascript vygenerovaný do stránky tedy funguje vlastně jako WS klient a serverová funkcionalita je realizována běžným psaním web services.</p><p>Díky tomu se nemusíte učit v podstatě nic nového, protože vše je integrováno do logiky ASP.NET: stačí do stránky umístit odpovídající server controls, napsat normální (okay, skoro normální) webovou službu a máte vyděláno. Nemusíte ani umět JavaScript, vše potřebné si vygeneruje ASP.NET Ajax sám, bez vaší laskavé asistence.</p><p>Náš příklad je řešením typického problému v případě globálních webových aplikací. Chcete po uživateli, aby vám prozradil, odkud je. Necháte ho vybrat zemi a poté, na základě toho, co vybral, nějaký bližší region, pokud se na ně vybraná země dělí. Pokud je uživatel z USA, bude tedy vybírat z amerických států. Pokud je z ČR, bude vybírat ze seznamu krajů atd. Obdobným způsobem můžete nechat uživatele vybrat libovolnou kombinaci na sobě závislých parametrů, např. u oblečení velikost, vzorek a barvu.</p><p>Data pro vytvoření seznamu zemí a regionů jsem čerpal z normy <a href="http://en.wikipedia.org/wiki/ISO_3166">ISO 3166</a>. Ta mimo jiné definuje pro jednotlivé země dvoupísmenné zkratky. Obvykle se shodují z názvem internetové top level domény (CZ = Česká republika, SK = Slovensko, DE = Německo...), ale ne vždy, např. pro Spojené království platí zkratka GB, nikoliv UK. Kód regionu je jedno- až třípísmenný a zapisuje se oddělen pomlčkou za kódem země. Tedy např. CZ-PR je kód pro Českou republiku, Hlavní město Praha.</p><p>Tyto kódy jsou uloženy v databázové tabulce, která obsahuje pole <code>Code</code> (kód země nebo regionu), <code>ParentCode</code> (kód nadřízené země nebo NULL) a <code>Name</code> (název země/regionu). Příslušný databázový soubor je součástí příkladu, najdete v něm také SQL skript pro vytvoření odpovídající tabulky a naplnění obsahem.</p><h2>Webová služba AjaxUI.asmx</h2><p>Vlastní načítání dat se děje pomocí webové služby, kterou jsem pojmenoval <code>~/AjaxUI.asmx</code>. Jedná se o normální web service, jedinou její zvláštností je nutnost odekorovat třídu kromě běžného atributu <code>System.Web.Services.WebService</code> také atributem <code>System.Web.Script.ScriptService</code>. Její metody, které mají být dostupné přes web, pak atributy <code>WebMethod</code> a <code>ScriptMethod</code>.</p><p>Pro naše účely jsou důležité metody <code>GetCountries</code> a <code>GetRegions</code>. Ty generují seznam položek rozbalovacího seznamu, v podobě pole tříd <code>AjaxControlToolkit.CascadingDropDownNameValue</code>. Mají dva stringové vstupní parametry: <code>knownCategoryValues</code> a <code>category</code>.</p><ul><li><code>knownCategoryValues</code> je seznam dříve vybraných (nadřazených) kategorií. K jeho rozparsování, resp. převedení na <code>StringDictionary</code>, je vhodné použít metodu <code>ParseKnownCategoryValuesString</code>. </li><li><code>category</code> je název kategorie, kterou právě vybíráme. Určuje ho nastavení vlastnosti <code>Category</code> u prvku <code>CascadingDropDown</code>.</li></ul><p><strong>Důležitá poznámka týkající se názvů parametrů:</strong> V .NET Frameworku všeobecně je jedno, jak se jednotlivé parametry metod jmenují, pokud mají odpovídající typ. V případě AJAX webových služeb toto neplatí a názvy parametrů se musejí přesně shodovat, včetmě velkých a malých písmen (a to i v jazyce Visual Basic .NET, který je jinak case insensitive). </p><p>Důvodem je skutečnost, že javascriptový web service klient je velmi jednoduchý a v podstatě web services jako takovým vůbec nerozumí, generuje a zpracovává přímo XML dokumenty, aniž by se obtěžoval analýzou WSDL specifikace a podobně. Formát XML dokumentu je dán mimo jiné také jmény předávaných parametrů a závisí v něm na velkých a malých písmenech.</p><p>Třída AjaxUI obsahuje pomocnou (privátní statickou) metodu <code>GetItems</code>, která vrací seznam všech položek z tabulky <code>Locations</code>, které mají defginovaný <code>ParentCode</code> (nebo je NULL, pokud je předaný parametr prázdný řetězec nebo <code>null</code>). Vlastní metody <code>GetCountries</code> a <code>GetRegions</code> jsou díky tomu velmi jednoduché:</p><div style="FONT-SIZE: 11pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas, Courier New, monospace"><p style="MARGIN: 0px">[<span style="COLOR: #2b91af">WebMethod</span>, <span style="COLOR: #2b91af">ScriptMethod</span>]</p><p style="MARGIN: 0px"><span style="COLOR: blue">public</span> <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>[] GetCountries(<span style="COLOR: blue">string</span> knownCategoryValues, <span style="COLOR: blue">string</span> category) {</p><p style="MARGIN: 0px">  <span style="COLOR: blue">if</span> (category != <span style="COLOR: #a31515">"Country"</span>) <span style="COLOR: blue">return</span> <span style="COLOR: blue">null</span>;      <span style="COLOR: green">// Invalid category requested</span></p><p style="MARGIN: 0px">  <span style="COLOR: blue">return</span> GetItems(<span style="COLOR: blue">null</span>);                       <span style="COLOR: green">// List all countries (locations with no parent)</span></p><p style="MARGIN: 0px">}</p><p style="MARGIN: 0px"> </p><p style="MARGIN: 0px">[<span style="COLOR: #2b91af">WebMethod</span>, <span style="COLOR: #2b91af">ScriptMethod</span>]</p><p style="MARGIN: 0px"><span style="COLOR: blue">public</span> <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>[] GetRegions(<span style="COLOR: blue">string</span> knownCategoryValues, <span style="COLOR: blue">string</span> category) {</p><p style="MARGIN: 0px">  <span style="COLOR: blue">if</span> (category != <span style="COLOR: #a31515">"Region"</span>) <span style="COLOR: blue">return</span> <span style="COLOR: blue">null</span>;       <span style="COLOR: green">// Invalid category requested</span></p><p style="MARGIN: 0px">  <span style="COLOR: #2b91af">StringDictionary</span> kv = <span style="COLOR: #2b91af">CascadingDropDown</span>.ParseKnownCategoryValuesString(knownCategoryValues);</p><p style="MARGIN: 0px">  <span style="COLOR: blue">if</span> (!kv.ContainsKey(<span style="COLOR: #a31515">"Country"</span>)) <span style="COLOR: blue">return</span> <span style="COLOR: blue">null</span>; <span style="COLOR: green">// No parent ctg (country) specified</span></p><p style="MARGIN: 0px">  <span style="COLOR: blue">return</span> GetItems(kv[<span style="COLOR: #a31515">"Country"</span>]);</p><p style="MARGIN: 0px">}</p></div><!--EndFragment--><p>Metoda <code>GetCountries</code> vrací seznam všech zemí (položek v tabulce, které mají <code>ParentCode</code> rovno <code>NULL</code>). Metoda <code>GetRegions</code> je o něco složitější, protože provádí shora naznačené parsování vybrané nadřazené kategorie. Protože typ požadovaných dat je určen hodnotou parametru<code>category</code>, bylo  by možné v obou případech volat jedinou metodu a větvení provést přímo v ní. Pro názornost jsem to napsal tímto rozvláčnějším způsobem.</p><p>Privání metoda <code>GetItems</code> načte položky z databáze a vrátí je v podobě pole <code>CascadingDropDownNameValue</code>:</p><div style="FONT-SIZE: 11pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas, Courier New, monospace"><p style="MARGIN: 0px"><span style="COLOR: blue">private</span> <span style="COLOR: blue">static</span> <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>[] GetItems(<span style="COLOR: blue">string</span> pc) {</p><p style="MARGIN: 0px">  <span style="COLOR: blue">string</span> cs = <span style="COLOR: #2b91af">ConfigurationManager</span>.ConnectionStrings[<span style="COLOR: #a31515">"Locations"</span>].ConnectionString;</p><p style="MARGIN: 0px">  <span style="COLOR: blue">string</span> sql = <span style="COLOR: #a31515">"SET ANSI_NULLS OFF;SELECT Code, Name FROM Locations WHERE ParentCode=@ParentCode ORDER BY Name"</span>;</p><p style="MARGIN: 0px"> </p><p style="MARGIN: 0px">  <span style="COLOR: blue">using</span> (<span style="COLOR: #2b91af">DataTable</span> dt = <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">DataTable</span>()) {</p><p style="MARGIN: 0px">    <span style="COLOR: green">// List all locations with specified parent or without parent at all</span></p><p style="MARGIN: 0px">    <span style="COLOR: blue">using</span> (<span style="COLOR: #2b91af">SqlConnection</span> db = <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">SqlConnection</span>(cs)) {</p><p style="MARGIN: 0px">      db.Open();</p><p style="MARGIN: 0px">      <span style="COLOR: blue">using</span> (<span style="COLOR: #2b91af">SqlCommand</span> cmd = <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">SqlCommand</span>(sql, db)) {</p><p style="MARGIN: 0px">        cmd.Parameters.Add(<span style="COLOR: #a31515">"@ParentCode"</span>, <span style="COLOR: #2b91af">SqlDbType</span>.VarChar, 10).Value = <span style="COLOR: #2b91af">DBNull</span>.Value;</p><p style="MARGIN: 0px">        <span style="COLOR: blue">if</span> (!<span style="COLOR: blue">string</span>.IsNullOrEmpty(pc)) cmd.Parameters[<span style="COLOR: #a31515">"@ParentCode"</span>].Value = pc;</p><p style="MARGIN: 0px">        <span style="COLOR: blue">using</span> (<span style="COLOR: #2b91af">SqlDataAdapter</span> da = <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">SqlDataAdapter</span>(cmd)) da.Fill(dt);</p><p style="MARGIN: 0px">      }</p><p style="MARGIN: 0px">    }</p><p style="MARGIN: 0px"> </p><p style="MARGIN: 0px">    <span style="COLOR: blue">if</span> (dt.Rows.Count == 0) {</p><p style="MARGIN: 0px">      <span style="COLOR: green">// No locations found</span></p><p style="MARGIN: 0px">      <span style="COLOR: blue">return</span> <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>[] {<span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>(<span style="COLOR: #a31515">"n/a"</span>, pc, <span style="COLOR: blue">true</span>)};</p><p style="MARGIN: 0px">    }</p><p style="MARGIN: 0px">    <span style="COLOR: blue">else</span> {</p><p style="MARGIN: 0px">      <span style="COLOR: green">// Convert DataTable to list of items</span></p><p style="MARGIN: 0px">      <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>[] r = <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>[dt.Rows.Count];</p><p style="MARGIN: 0px">      <span style="COLOR: blue">for</span> (<span style="COLOR: blue">int</span> i = 0; i &lt; dt.Rows.Count; i++) {</p><p style="MARGIN: 0px">        r[i] = <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">CascadingDropDownNameValue</span>(<br>                   dt.Rows[i][<span style="COLOR: #a31515">"Name"</span>] <span style="COLOR: blue">as</span> <span style="COLOR: blue">string</span>, <br>                   dt.Rows[i][<span style="COLOR: #a31515">"Code"</span>] <span style="COLOR: blue">as</span> <span style="COLOR: blue">string</span>);</p><p style="MARGIN: 0px">      }</p><p style="MARGIN: 0px">      <span style="COLOR: blue">return</span> r;</p><p style="MARGIN: 0px">    }</p><p style="MARGIN: 0px">  }</p><p style="MARGIN: 0px">}</p></div><!--EndFragment--><h2>Volání webové služby</h2><p>Vlastní ASPX stránka vypadá takto:</p><div style="FONT-SIZE: 11pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas, Courier New, monospace"><p style="MARGIN: 0px"><span style="BACKGROUND: #ffee62">&lt;%</span><span style="COLOR: blue">@</span><span style="COLOR: #a31515">Page</span> <span style="COLOR: red">Language</span><span style="COLOR: blue">="C#"</span> <span style="COLOR: red">AutoEventWireup</span><span style="COLOR: blue">="true"</span> <span style="COLOR: red">CodeFile</span><span style="COLOR: blue">="Default.aspx.cs"</span> </p><p style="MARGIN: 0px">        <span style="COLOR: red">Inherits</span><span style="COLOR: blue">="_Default"</span> <span style="COLOR: red">EnableEventValidation</span><span style="COLOR: blue">="false"</span> <span style="BACKGROUND: #ffee62">%&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;!</span><span style="COLOR: #a31515">DOCTYPE</span> <span style="COLOR: red">html</span> <span style="COLOR: red">PUBLIC</span> <span style="COLOR: blue">"-//W3C//DTD XHTML 1.1//EN"</span> </p><p style="MARGIN: 0px">                      <span style="COLOR: blue">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">html</span> <span style="COLOR: red">xmlns</span><span style="COLOR: blue">="http://www.w3.org/1999/xhtml"&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">head</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"&gt;</span></p><p style="MARGIN: 0px">  <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">title</span><span style="COLOR: blue">&gt;</span>Untitled Page<span style="COLOR: blue">&lt;/</span><span style="COLOR: #a31515">title</span><span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;/</span><span style="COLOR: #a31515">head</span><span style="COLOR: blue">&gt;</span> </p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">body</span><span style="COLOR: blue">&gt;</span> </p><p style="MARGIN: 0px">  <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">form</span> <span style="COLOR: red">id</span><span style="COLOR: blue">="form1"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"&gt;</span></p><p style="MARGIN: 0px">    <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">asp</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">ScriptManager</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="ScriptManager1"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span>  <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">    <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">div</span><span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px">      <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">asp</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">DropDownList</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="DropDownListCountry"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">      <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">asp</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">DropDownList</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="DropDownListRegion"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">      <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">asp</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">Button</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="ButtonSubmit"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span> <span style="COLOR: red">Text</span><span style="COLOR: blue">="OK"</span> </p><p style="MARGIN: 0px">                  <span style="COLOR: red">OnClick</span><span style="COLOR: blue">="ButtonSubmit_Click"</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">      <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">asp</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">RequiredFieldValidator</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="RequiredFieldValidator1"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span> </p><p style="MARGIN: 0px">                                  <span style="COLOR: red">ErrorMessage</span><span style="COLOR: blue">="Location is not selected!"</span> </p><p style="MARGIN: 0px">                                  <span style="COLOR: red">ControlToValidate</span><span style="COLOR: blue">="DropDownListRegion"</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">      <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">br</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">      <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">asp</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">Label</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="LabelSelected"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">    <span style="COLOR: blue">&lt;/</span><span style="COLOR: #a31515">div</span><span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px">    <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">ajaxToolkit</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">CascadingDropDown</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="CascadingDropDownCountry"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">TargetControlID</span><span style="COLOR: blue">="DropDownListCountry"</span></p><p style="MARGIN: 0px">                                   <span style="COLOR: red">Category</span><span style="COLOR: blue">="Country"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">LoadingText</span><span style="COLOR: blue">="Loading countries..."</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">PromptText</span><span style="COLOR: blue">="-- select country --"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">ServicePath</span><span style="COLOR: blue">="~/AjaxUI.asmx"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">ServiceMethod</span><span style="COLOR: blue">="GetCountries"</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">    <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">ajaxToolkit</span><span style="COLOR: blue">:</span><span style="COLOR: #a31515">CascadingDropDown</span> <span style="COLOR: red">ID</span><span style="COLOR: blue">="CascadingDropDownRegion"</span> <span style="COLOR: red">runat</span><span style="COLOR: blue">="server"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">TargetControlID</span><span style="COLOR: blue">="DropDownListRegion"</span></p><p style="MARGIN: 0px">                                   <span style="COLOR: red">ParentControlID</span><span style="COLOR: blue">="DropDownListCountry"</span></p><p style="MARGIN: 0px">                                   <span style="COLOR: red">Category</span><span style="COLOR: blue">="Region"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">LoadingText</span><span style="COLOR: blue">="Loading regions..."</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">PromptText</span><span style="COLOR: blue">="-- select state or region --"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">ServicePath</span><span style="COLOR: blue">="~/AjaxUI.asmx"</span> </p><p style="MARGIN: 0px">                                   <span style="COLOR: red">ServiceMethod</span><span style="COLOR: blue">="GetRegions"</span> <span style="COLOR: blue">/&gt;</span></p><p style="MARGIN: 0px">  <span style="COLOR: blue">&lt;/</span><span style="COLOR: #a31515">form</span><span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;/</span><span style="COLOR: #a31515">body</span><span style="COLOR: blue">&gt;</span> </p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;/</span><span style="COLOR: #a31515">html</span><span style="COLOR: blue">&gt;</span> </p></div><!--EndFragment--><p>V první řadě je třeba vypnout event validation, protože položky se do dropdownlistu doplňují dynamicky.</p><p>Dále pak je, jako u všech stránek, které využívají ASP.NET Ajax, třeba do stránky umístit prvek <code>ScriptManager</code>.</p><p>Poslední zásadní změnu představují dva prvky <code>CascadingDropDown</code>, které se starají o vlastní napojení <code>DropDownList</code>u na webovou službu. Mají tyto důležité vlastnosti (atributy): </p><ul><li><code>TargetControlID</code> je ID prvku (DropDownList), který mají plnit.</li><li><code>ParentControlID</code> je ID prvku (DropDownList), který patří nadřazené kategorii. Neuvádí se u seznamu na vrcholu hierarchie.</li><li><code>Category</code> je název kategorie parametrů, která se váže k danému prvku. Předá se zvolené metodě jako hodnota parametru <code>category</code>.</li><li><code>LoadingText</code> je text, který se zobrazí po dobu načítání XML dokumentu z webové služby.</li><li><code>PromptText</code> je text výzvy, která se v seznamu zobrazí po načtení dat.</li><li><code>ServicePath</code> je cesta k webové službě pro naplnění daty.</li><li><code>ServiceMethod</code> je název její metody, která vrátí data.</li></ul><h2>Závěr</h2><p>ASP.NET Ajax a Ajax Control Toolkit představují snadno možnost jak psát interaktivnější a pro uživatele pohodlnější aplikace, aniž byste museli vynakládat velké množství úsilí na tvorbu a ladění skriptů pro různé prohlížeče a podobně. Na druhou stranu se mohou stát technologií, která vaši aplikaci zcela pohřbí: nedostatečným výkonem, bezpečnostními dírami a podobně.</p><p>Neexistují dobré a špatné technologie, existují pouze technologie vhodně a nevhodně použité. Pokud vás zajímají podrobnosti o ASP.NET Ajaxu a vhodné a nevhodné scénáře použití, přijďte na můj seminář <a href="http://akce.altairis.cz/Events/25.aspx">ASP.NET Ajax: Jak ho použít a proč to nedělat</a>, který se koná 16. ledna 2007 v budově Microsoftu v Praze.</p><ul><li><a href="https://www.cdn.altairis.cz/Blog/2007/20070105-Ajax-DDL-Sample.zip">Zdrojové kódy a databáze k tomuto příkladu</a> (~900 kB ZIP)</li></ul>

      </section>
      <section class="issues">
        <header>
          <i class="fab fa-github">​</i> Je v článku něco špatně? Chcete něco doplnit?</header>
        <p>Komentáře zde nenajdete, ale pokud je v článku chyba nebo k němu chcete něco věcného doplnit, můžete na GitHubu <a href="https://github.com/ridercz/Blog/issues/new?title=AJAX+Control+Toolkit%3a+Jak+na+propojen%c3%a9+rozbalovac%c3%ad+seznamy%3f&amp;body=https://www.altair.blog/2007/01/ajax-control-toolkit-jak-na-propojene-rozbalovaci-seznamy">otevřít nový issue</a> nebo <a href="https://github.com/ridercz/Blog/edit/master/source/2007/01/ajax-control-toolkit-jak-na-propojene-rozbalovaci-seznamy.md">navrhnout změnu v textu</a> a poslat mi pull request.</p>
        <p>Tamtéž také najdete <a href="https://github.com/ridercz/Blog/commits/master/source/2007/01/ajax-control-toolkit-jak-na-propojene-rozbalovaci-seznamy.md">historii všech verzí článku</a>, pokud v něm byly provedeny nějaké změny či úpravy.</p>
      </section>
      <section class="sharing">
        <span>Pošli to dál:</span>
        <ul>
          <li>
            <a href="https://twitter.com/intent/tweet?text=https://www.altair.blog/2007/01/ajax-control-toolkit-jak-na-propojene-rozbalovaci-seznamy">
              <i class="fab fa-x-twitter">​</i>
            </a>
          </li>
          <li>
            <a href="https://www.facebook.com/sharer.php?u=https://www.altair.blog/2007/01/ajax-control-toolkit-jak-na-propojene-rozbalovaci-seznamy">
              <i class="fab fa-facebook-f">​</i>
            </a>
          </li>
        </ul>
      </section>
    </main>
    <footer>
      <ul class="logos">
        <li>
          <img src="/content/images/logo_onwhite.svg" alt="altair.blog" style="height:38px;" />
        </li>
      </ul>
      <ul class="text">
        <li>
          Copyright © <a href="https://www.rider.cz/">Michal Altair Valášek</a>, 2003-2024</li>
        <li>
          Powered by <a href="https://www.xml4web.com/">XML4web</a> on <a href="https://www.github.com/">GitHub Pages</a></li>
        <li>
          <i class="fal fa-rss">​</i> RSS: <a href="/feed.rss">všechno</a> | <a href="/feed-internal.rss">místní</a> | <a href="/feed-external.rss">odkazy</a></li>
      </ul>
    </footer>
  </body>
</html>