<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Použití Geolocation API z ASP.NET Web Forms | ALTAIR.blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="cs-CZ" />
    <link rel="canonical" href="https://www.altair.blog/2011/06/pouziti-geolocation-api-z-asp-net-web-forms" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.css" integrity="sha512-LaxQmGd9k/pW51CsEy2nLIlbUXCgsyvUEVT5fSguN2b2OBwHjMi2aiUdEEXSMg8Jvy+bCB01as61aNrHnL2DYQ==" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="/content/styles.min.css?sha=C19CD55613F8A8210E05CBD8634AB3877810578E" />
    <link rel="stylesheet" type="text/css" href="/content/fa-5.13.1/css/all.min.css" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed.rss" title="RSS (všechny články)" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed-internal.rss" title="RSS (pouze místní články)" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed-external.rss" title="RSS (pouze odkazy)" />
    <link rel="shortcut icon" href="https://www.altair.blog/favicon.ico" />
    <link rel="icon" href="https://www.altair.blog/favicon.ico" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@ridercz" />
    <meta name="twitter:title" content="Použití Geolocation API z ASP.NET Web Forms" />
    <meta name="twitter:description" content="Jedna z novinek, které nabízejí současné prohlížeče, je Geolocation API. Prohlížeč umí zjistit, kde se fyzicky nacházíte a tuto informaci (po vašem předchozím souhlasu) stránce pomocí JavaScriptu sdělit. Podíváme se, jak tuto funkci můžete využít a nabídnu vám hotovou komponentu pro ASP.NET Web Forms, která to zajišťuje." />
    <meta name="twitter:image" content="https://www.altair.blog/content/images/preview-1200.jpg" />
    <meta property="article:published_time" content="2011-06-29T00:00:00+02:00" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="ALTAIR.blog" />
    <meta name="author" content="Michal Altair Valášek" />
    <meta name="title" property="og:title" content="Použití Geolocation API z ASP.NET Web Forms" />
    <meta name="description" property="og:description" content="Jedna z novinek, které nabízejí současné prohlížeče, je Geolocation API. Prohlížeč umí zjistit, kde se fyzicky nacházíte a tuto informaci (po vašem předchozím souhlasu) stránce pomocí JavaScriptu sdělit. Podíváme se, jak tuto funkci můžete využít a nabídnu vám hotovou komponentu pro ASP.NET Web Forms, která to zajišťuje." />
    <meta name="image" property="og:image" content="https://www.altair.blog/content/images/preview-1200.jpg" />
    <meta property="og:locale" content="cs_CZ" />
    <meta property="og:url" content="https://www.altair.blog/2011/06/pouziti-geolocation-api-z-asp-net-web-forms" />
    <script>
      (function(f, a, t, h, o, m){
        a[h]=a[h]||function(){
          (a[h].q=a[h].q||[]).push(arguments)
        };
        o=f.createElement('script'),
        m=f.getElementsByTagName('script')[0];
        o.async=1; o.src=t; o.id='fathom-script';
        m.parentNode.insertBefore(o,m)
      })(document, window, '//stats.altair.blog/tracker.js', 'fathom');
      fathom('set', 'siteId', 'OBOTR');
      fathom('trackPageview');
    </script>
    <script src="/content/scripts/autocorrect.js?sha=3D24FB150C3151FFF3B9BFCA112E1A8B2F32B377" defer="defer" onload="typo.runAutoCorrector({number: false})">//</script>
    <meta name="robots" content="index, follow" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css" integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin="anonymous" />
  </head>
  <body>
    <header>
      <div>
        <a href="/">
          <img src="/content/images/logo_onblack.svg" alt="altair.blog" style="max-height:100px;max-width:80%" />
        </a>
      </div>
    </header>
    <nav>
      <ul>
        <li>
          <a href="https://www.rider.cz/" title="Autor: Michal Altair Valášek">
            <i class="fal fa-fw fa-user"> </i>
          </a>
        </li>
        <li>
          <a href="/archive" title="Archiv článků">
            <i class="fal fa-fw fa-archive"> </i>
          </a>
        </li>
        <li>
          <a href="/categories" title="Rubriky">
            <i class="fal fa-fw fa-tags"> </i>
          </a>
        </li>
        <li>
          <a href="/serials" title="Seriály">
            <i class="fal fa-fw fa-list-alt"> </i>
          </a>
        </li>
        <li>
          <a href="/search" title="Vyhledávání">
            <i class="fal fa-fw fa-search"> </i>
          </a>
        </li>
        <li>
          <a href="https://www.rider.cz/#contact" title="Kontakt">
            <i class="fal fa-fw fa-envelope"> </i>
          </a>
        </li>
        <li>
          <a href="https://facebook.com/rider.cz" title="Facebook">
            <i class="fab fa-fw fa-facebook"> </i>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/ridercz" title="Twitter">
            <i class="fab fa-twitter"> </i>
          </a>
        </li>
        <li>
          <a href="https://github.com/ridercz" title="Github">
            <i class="fab fa-fw fa-github"> </i>
          </a>
        </li>
        <li>
          <a href="https://ask.fm/ridercz" title="Ask.fm">
            <i class="fal fa-fw fa-question"> </i>
          </a>
        </li>
      </ul>
    </nav>
    <main>
      <h1>Použití Geolocation API z ASP.NET Web Forms</h1>
      <aside class="article-info">
        <ul class="categories">
          <li>
            <a href="/categories/it" title="Rubrika">
              <i class="fal fa-tag"> </i>IT</a>
          </li>
        </ul>
        <div title="Autor">
          <a href="https://www.rider.cz/">Michal Altair Valášek </a>
          <i class="fal fa-user">​</i>
        </div>
        <div title="Datum vydání">
          <time datetime="2011-06-29T00:00:00+02:00">29. června 2011 <i class="fal fa-calendar-alt">​</i></time>
        </div>
      </aside>
      <section class="article-text">
        <p>Jedna z novinek, které nabízejí současné prohlížeče (od verzí: IE 9, FF 3.5, Chrome 5.0, Safari 5.0, Opera 10.60) je Geolocation API. Prohlížeč umí zjistit, kde se fyzicky nacházíte a tuto informaci (po vašem předchozím souhlasu) stránce pomocí JavaScriptu sdělit. Podíváme se, jak tuto funkci můžete využít a nabídnu vám hotovou komponentu pro ASP.NET Web Forms, která to zajišťuje.</p>
<h2>Co je Geolocation API a jak funguje?</h2>
<p>Geolocation API je technologie (definovaná <a href="http://www.w3.org/TR/geolocation-API/">specifikací W3C</a>), která umožňuje v kompatibilních prohlížečích z JavaScriptu zjistit, kde se právě fyzicky nachází zařízení, které stránku prohlíží. Webové aplikace mohou tuto informaci využít celou řadou způsobů, typicky například "najdi nejbližší pobočku" atd. Ještě větší využití nabízí geolokace v mobilních zařízeních.</p>
<p>Standard definuje jenom rozhraní (API), kterým si aplikace může vyžádat informaci o poloze. Nijak neřeší, jakým způsobem má zařízení tyto informace získat. Nabízí se samozřejmě použití GPS, ale to není vždy možné nebo účelné. GPS přijímač je většinou jenom v mobilních telefonech, běžné počítače a notebooky jím obvykle nedisponují. Také nefunguje uvnitř budov a jeho použití může být energeticky dost náročné.</p>
<p>Skutečnou implementaci v mobilních zařízeních jsem nezkoumal, ale v případě desktopových zařízení lokalizace probíhá na základě IP adresy a dostupných WiFi sítí. V případě požadavku na lokalizaci browser sesbírá údaje o okolních WiFi sítích, tedy jejich názvy, MAC adresy AP a sílu signálu. Tyto údaje pošle lokalizační službě, která je porovná se svou databází WiFi AP se známým umístěním a na základě toho vypočítá pravděpodobnou polohu, kterou pošle zpět. Při výpočtu používá také IP adresu, z níž požadavek přišel. Pokud zařízení nemá WiFi a nebo je vypnutá, jedná se o jediný zdroj, z něhož může být poloha odvozena.</p>
<h3>Microsoft Internet Explorer</h3>
<p>MSIE 9.0 pošle na adresu <a href="https://inference.location.live.net/inferenceservice/v21/Pox/GetLocationUsingFingerprint">https://inference.location.live.net/inferenceservice/v21/Pox/GetLocationUsingFingerprint</a> následující požadavek (formátováno, zkráceno a mírně cenzurováno):</p>
<pre style="background: white; color: black; font-family: consolas;"><span style="color: blue;">&lt;</span><span style="color: rgb(163, 21, 21);">GetLocationUsingFingerprint</span><span style="color: blue;">&nbsp;</span><span style="color: red;">xmlns</span><span style="color: blue;">=</span>"<span style="color: blue;">http://inference.location.live.com</span>"<span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">RequestHeader</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">Timestamp</span><span style="color: blue;">&gt;</span>2011-06-29T19:32:17.0000094Z<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">Timestamp</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">ApplicationId</span><span style="color: blue;">&gt;</span>e1e71f6b-2149-45f3-a298-a20682ab5017<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">ApplicationId</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">TrackingId</span><span style="color: blue;">&gt;</span>00000000-0000-0000-0000-000000000000<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">TrackingId</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">DeviceProfile</span><span style="color: blue;">&nbsp;</span><span style="color: red;">ClientGuid</span><span style="color: blue;">=</span>"<span style="color: blue;">00000000-0000-0000-0000-000000000000</span>"
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: red;">Platform</span><span style="color: blue;">=</span>"<span style="color: blue;">Windows7</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">ExtendedDeviceInfo</span><span style="color: blue;">=</span>""
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: red;">DeviceType</span><span style="color: blue;">=</span>"<span style="color: blue;">PC</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">LFVersion</span><span style="color: blue;">=</span>"<span style="color: blue;">9.0.8112.16430</span>"
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: red;">OSVersion</span><span style="color: blue;">=</span>"<span style="color: blue;">7601.17592.amd64fre.win7sp1_gdr.110408-1631</span>"<span style="color: blue;">&nbsp;/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">Authorization</span><span style="color: blue;">&nbsp;/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: rgb(163, 21, 21);">RequestHeader</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">BeaconFingerprint</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">Detections</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">Wifi7</span><span style="color: blue;">&nbsp;</span><span style="color: red;">BssId</span><span style="color: blue;">=</span>"<span style="color: blue;">1c:af:f7:xx:xx:xx</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">rssi</span><span style="color: blue;">=</span>"<span style="color: blue;">-29</span>"<span style="color: blue;">&nbsp;/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">Wifi7</span><span style="color: blue;">&nbsp;</span><span style="color: red;">BssId</span><span style="color: blue;">=</span>"<span style="color: blue;">1c:bd:b9:xx:xx:xx</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">rssi</span><span style="color: blue;">=</span>"<span style="color: blue;">-34</span>"<span style="color: blue;">&nbsp;/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: rgb(163, 21, 21);">Detections</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: rgb(163, 21, 21);">BeaconFingerprint</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">GetLocationUsingFingerprint</span><span style="color: blue;">&gt;</span></pre>
<p>Jako odpověď dostane zpět XML dokument s informacemi o poloze:</p>
<pre style="background: white; color: black; font-family: consolas;"><span style="color: blue;">&lt;</span><span style="color: rgb(163, 21, 21);">GetLocationUsingFingerprintResponse</span><span style="color: blue;">&nbsp;</span><span style="color: red;">xmlns</span><span style="color: blue;">=</span>"<span style="color: blue;">http://inference.location.live.com</span>"<span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">GetLocationUsingFingerprintResult</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">ResponseStatus</span><span style="color: blue;">&gt;</span>Success<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">ResponseStatus</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">LocationResult</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">ResolverStatus</span><span style="color: blue;">&nbsp;</span><span style="color: red;">Status</span><span style="color: blue;">=</span>"<span style="color: blue;">Success</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">Source</span><span style="color: blue;">=</span>"<span style="color: blue;">Internal</span>"<span style="color: blue;">/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">ResolvedPosition</span><span style="color: blue;">&nbsp;</span><span style="color: red;">Latitude</span><span style="color: blue;">=</span>"<span style="color: blue;">52.16274</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">Longitude</span><span style="color: blue;">=</span>"<span style="color: blue;">21.04295</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">Altitude</span><span style="color: blue;">=</span>"<span style="color: blue;">0</span>"<span style="color: blue;">/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">RadialUncertainty</span><span style="color: blue;">&gt;</span>500<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">RadialUncertainty</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">TileResult</span><span style="color: blue;">/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">TrackingId</span><span style="color: blue;">&gt;</span>00000000-0000-0000-0000-000000000000<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">TrackingId</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: rgb(163, 21, 21);">LocationResult</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: rgb(163, 21, 21);">ExtendedV21Result</span><span style="color: blue;">&nbsp;</span><span style="color: red;">CrowdSourcingLevel</span><span style="color: blue;">=</span>"<span style="color: blue;">Medium</span>"
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: red;">ServerUtcTime</span><span style="color: blue;">=</span>"<span style="color: blue;">2011-06-29T19:32:18.3846551Z</span>"<span style="color: blue;">/&gt;</span>
<span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: rgb(163, 21, 21);">GetLocationUsingFingerprintResult</span><span style="color: blue;">&gt;</span>
<span style="color: blue;">&lt;/</span><span style="color: rgb(163, 21, 21);">GetLocationUsingFingerprintResponse</span><span style="color: blue;">&gt;</span></pre>
<p>Lokalizační služba Microsoftu v mém případě moc nefunguje a vytrvale mne umisťuje kamsi do centra Varšavy. Zde se projevuje jedna ze zásadních nevýhod crowdsourcingového určování polohy: předpokládá, že MAC adresy WiFi AP budou unikátní (zkušenost praví, že MAC adresy čehokoliv nejsou zase až tak unikátní, jak by měly být) a že budou neměnné. Některé z AP v mém okolí má zjevně dvojče v Polsku.</p>
<h3>Google</h3>
<p>Ostatní prohlížeče používají geolokační službu od Google. Například Chrome se táže adresy <a href="https://www.google.com/loc/json" title="https://www.google.com/loc/json">https://www.google.com/loc/json</a> a posílá jí v JSON serializaci následující data (též zkráceno, formátováno a mírně cenzurováno):</p>
<pre style="background: white; color: black; font-family: consolas;">{
&nbsp;&nbsp;<span style="color: maroon;">"access_token"</span>:&nbsp;<span style="color: maroon;">"x:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>,
&nbsp;&nbsp;<span style="color: maroon;">"host"</span>:&nbsp;<span style="color: maroon;">"localhost"</span>,
&nbsp;&nbsp;<span style="color: maroon;">"radio_type"</span>:&nbsp;<span style="color: maroon;">"unknown"</span>,
&nbsp;&nbsp;<span style="color: maroon;">"request_address"</span>:&nbsp;<span style="color: blue;">false</span>,
&nbsp;&nbsp;<span style="color: maroon;">"version"</span>:&nbsp;<span style="color: maroon;">"1.1.0"</span>,
&nbsp;&nbsp;<span style="color: maroon;">"wifi_towers"</span>:&nbsp;[
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"age"</span>:&nbsp;0,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"mac_address"</span>:&nbsp;<span style="color: maroon;">"00-0e-2e-xx-xx-xx"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"signal_strength"</span>:&nbsp;-59,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"ssid"</span>:&nbsp;<span style="color: maroon;">"corp.altairis.cz"</span>
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"age"</span>:&nbsp;0,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"mac_address"</span>:&nbsp;<span style="color: maroon;">"1c-af-f7-xx-xx-xx"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"signal_strength"</span>:&nbsp;-29,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"ssid"</span>:&nbsp;<span style="color: maroon;">"brno.public.altairis.cz"</span>
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"age"</span>:&nbsp;0,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"mac_address"</span>:&nbsp;<span style="color: maroon;">"1c-bd-b9-xx-xx-xx"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"signal_strength"</span>:&nbsp;-38,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"ssid"</span>:&nbsp;<span style="color: maroon;">"corp.altairis.cz"</span>
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;]
}</pre>
<p>Zpět obdrží opět JSON serializovanou informaci:</p>
<pre style="background: white; color: black; font-family: consolas;">{
&nbsp;&nbsp;<span style="color: maroon;">"location"</span>:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"latitude"</span>:&nbsp;49.123456,
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"longitude"</span>:&nbsp;16.123456,
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon;">"accuracy"</span>:&nbsp;144.0
&nbsp;&nbsp;}
}</pre>
<p>Je vidět, že Google má (zřejmě i zásluhou StreetView wardrivingu) lepší databáze, pozici určil s mnohem větší reálnou přesností. Obecně i Microsoftu to docela funguje, jenom u mne doma ne.</p>
<p>Pokud je WiFi vypnutá, přesnost se výrazně sníží. Google mne v takovém případě hodí do centra Brna (předpokládám, že dokáže zjistit, že jsem v Brně a nic víc). Podle Microsoftu jsem pořád ve Varšavě, ale předpokládám, že se to nějak cacheuje, protože v Praze to fungovalo docela dobře.</p>
<h2>Soukromí</h2>
<p>Stránka samozřejmě nemůže získat informace o poloze jenom tak, bez souhlasu uživatele. Pokud se stránka pokusí použít geolokaci, prohlížeč vás na to upozorní a vyžádá si váš souhlas. Všechny prohlížeče tak činí neintruzivním způsobem, ukážou někde nějakou "bublinu", nevyhodí klasický obtěžující dialog. Takhle to vypadá v IE 9:</p>
<p><a href="https://www.cdn.altairis.cz/Blog/2011/20110629-geolocation_2.png"><img width="610" height="137" title="geolocation" style="margin-right: auto; margin-left: auto; float: none; display: block;" alt="geolocation" src="https://www.cdn.altairis.cz/Blog/2011/20110629-geolocation_thumb.png"></a></p>
<p>Z hlediska webového uživatele tedy valné nebezpečí nehrozí. Otázky však vyvolávají samotné WPS (WiFi Positioning Systems), tedy shora popsaná metoda shromažďování dat o pozici WiFi AP. Dobrý úvod do problematiky najdete například na webu <a href="http://www.identityblog.com/?p=1191">Kima Camerona</a>.</p>
<h2>Implementace v JavaScriptu</h2>
<p>Využití Geolocation API v JavaScriptu je poměrně dobře popsáno <a href="http://www.w3.org/TR/geolocation-API/">v samotném standardu</a>, včetně ukázkového kódu. Dokonce i JavaScriptoví začátečníci, jako jsem já, by si s ním měli umět poradit. O vše se stará objekt <em>navigator.geolocation</em> (pokud je <em>null</em>, tak prohlížeč geolokaci nepodporuje). Ten má metodu <em>getCurrentPosition</em>, která volá dva callbacky, jeden pro úspěch a jeden pro případ selhání. </p>
<p>Lze také určit parametry zjištění pozice:</p>
<ul>
    <li><em>enableHighAccuracy</em> říká, že prohlížeč má použít nejpřesnější možnou metodu určení, a to i za cenu delšího zjišťování polohy a nebo vyšší spotřeby energie. Základní myšlenka je taková, že např. mobilní zařízení může běžně používat určení polohy podle GSM sítě nebo WiFi, což je méně náročné, ale aplikace si může vyžádat zapnutí GPS modulu ve chvíli, kdy potřebuje přesnou polohu, například pro navigaci. Není mi známo, nakolik je tato idea v praxi implementována. Výchozí hodnota je <em>false</em>. </li>
    <li><em>maximumAge</em> povoluje prohlížeči použít nacacheovanou hodnotu známou z minula, pokud je novější než daný počet milisekund. Pokud je hodnota nepřítomna nebo nastavena na 0, nesmí prohlážeč cacheovanou hodnotu použít. Podle mých testů v praxi všechny desktopové prohlížeče tuto hodnotu ignorují a cacheují si, jak je jim libo. </li>
    <li><em>timeout</em> říká, do kolika milisekund musí být získána odpověď. Nestihne-li se to, zahlásí volání chybu. Pokud je hodnota nepřítomna nebo nastavena na <em>Infinity</em>, timeout neexistuje. V tomto čase není zahrnuto čekání na odpověď uživatele, zda s geolokací souhlasí. Vaše implementace by tedy měla počítat s tím, že se nedočká vůbec žádného callbacku, pokud bude uživatel výzvu prostě ignorovat. </li>
</ul>
<p>V případě úspěšného získání pozice se zavolá callback, který obdrží informace o poloze a případně též směru a rychlosti pohybu (testované desktopové prohlížeče toto vcelku logicky nepodporují). Také dostanete timestamp, čas k němuž byly údaje zjištěny.</p>
<p>V případě chyby je zavolán jiný callback, který obdrží kód chyby, k němuž došlo (1 = uživatel nesouhlasil, 2 = pozice není dostupná, 3 = timeout).</p>
<p>Kromě toho ještě existuje způsob pro získání pravidelných informací o změnách polohy, ale tím se v tomto článku zabývat nebudeme.</p>
<h2>Implementace v ASP.NET</h2>
<p>Co když potřebujeme získané údaje nějak dostat na serverovou stranu, co ASP.NET? To už Geolocation API neřeší, tomu jde čistě o klientské rozhraní. Záleží samozřejmě na předpokládané aplikaci, někdy bude třeba používat AJAXové callbacky a podobně. Často ale můžete chtít zpracovávat data v rámci odeslaného formuláře stránky samé.</p>
<p>Napsal jsem komponentu, která si na straně klienta zjistí veškeré dostupné údaje pomocí JS Geolocation API a serializuje je do skrytého pole formuláře. Při následném postbacku pak data proparsuje a dává k dispozici pomocí svých vlastností. Zpřístupňuje tedy Geolocation API i těm programátorům, kteří se JavaScriptem nehodlají zabývat.</p>
<p>Komponenta je vyzkoušená v nejnovějších verzích IE, Chrome, Firefoxu a Opery, fungovat by měla i v ostatních prohlížečích (mobilních) a ve starších prohlížečích, které geolokaci nepodporují, se chová mravně.</p>
<p>Stáhněte si <strong><a href="https://www.cdn.altairis.cz/Blog/2011/20110629-Geolocation.zip">zdrojové kódy a ukázkovou aplikaci</a></strong>. Tato komponenta bude součástí další verze <a href="http://altairiswebui.codeplex.com/">Altairis Web UI Toolkitu</a>, ale v současné verzi 2.1.7 dosud není.</p>

      </section>
      <section class="issues">
        <header>
          <i class="fab fa-github">​</i> Je v článku něco špatně? Chcete něco doplnit?</header>
        <p>Komentáře zde nenajdete, ale pokud je v článku chyba nebo k němu chcete něco věcného doplnit, můžete na GitHubu <a href="https://github.com/ridercz/Blog/issues/new?title=Pou%c5%beit%c3%ad+Geolocation+API+z+ASP.NET+Web+Forms&amp;body=https://www.altair.blog/2011/06/pouziti-geolocation-api-z-asp-net-web-forms">otevřít nový issue</a> nebo <a href="https://github.com/ridercz/Blog/edit/master/source/2011/06/pouziti-geolocation-api-z-asp-net-web-forms.md">navrhnout změnu v textu</a> a poslat mi pull request.</p>
        <p>Tamtéž také najdete <a href="https://github.com/ridercz/Blog/commits/master/source/2011/06/pouziti-geolocation-api-z-asp-net-web-forms.md">historii všech verzí článku</a>, pokud v něm byly provedeny nějaké změny či úpravy.</p>
      </section>
      <section class="sharing">
        <span>Pošli to dál:</span>
        <ul>
          <li>
            <a href="https://twitter.com/intent/tweet?text=https://www.altair.blog/2011/06/pouziti-geolocation-api-z-asp-net-web-forms">
              <i class="fab fa-twitter">​</i>
            </a>
          </li>
          <li>
            <a href="https://www.facebook.com/sharer.php?u=https://www.altair.blog/2011/06/pouziti-geolocation-api-z-asp-net-web-forms">
              <i class="fab fa-facebook-f">​</i>
            </a>
          </li>
        </ul>
      </section>
    </main>
    <footer>
      <ul class="logos">
        <li>
          <img src="/content/images/logo_onwhite.svg" alt="altair.blog" style="height:38px;" />
        </li>
      </ul>
      <ul class="text">
        <li>
          Copyright © <a href="https://www.rider.cz/">Michal Altair Valášek</a>, 2003-2021</li>
        <li>
          Powered by <a href="https://www.xml4web.com/">XML4web</a> on <a href="https://www.github.com/">GitHub Pages</a></li>
        <li>
          <i class="fal fa-rss">​</i> RSS: <a href="/feed.rss">všechno</a> | <a href="/feed-internal.rss">místní</a> | <a href="/feed-external.rss">odkazy</a></li>
      </ul>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha512-lnOllyZZlRk/gQIyjS3+h+LUy54uyM4aGq2zbGc82KTvBlp/fodSpdh/pywPztpU9zUqHcJr+jP+a1zLa9oCJw==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/csharp.min.js" integrity="sha512-dQorbxHDJF0jQ9jDdUgFc3PfpIxRV18/EMI7ToQTe2fbD8HAms+eNjpLI+A0SMB/YQIc/NeFhBYSX/UCaEoIzg==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/css.min.js" integrity="sha512-UBNT6+S1FuSLwHTzfo6BqVU4AOKftOiict0fXKr4Vwz3YIjgsVURHxzHg3wWIwDawWumMO7JrluSLost+8i3UA==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/dos.min.js" integrity="sha512-LRcU/W7unzxQuTXoNa9NeNEoRXpWF/VQox8aCXnYPJHr21ymV27zmTXxxPALiMvDuFVMMBLHHUGXCiYFiR2uZg==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/javascript.min.js" integrity="sha512-B2u4F4jxoEQ90yVLebzbcexcdZGtECyokKRU0ribbBBxcsZFn6i4n9AU7UjmMFHj08AYiY0GrZsom5lWoZTY3g==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/markdown.min.js" integrity="sha512-utO8hnm2PGjXvKsyf/H6ZUaFlctc2aiDmC9fNqcyycD8rEAxFM6rTrcpY9MUfkbrXLF9tfU8kQWD9dotZ77gKQ==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/openscad.min.js" integrity="sha512-bSZUmtiZseL0VujlVGN75faBxoAE9RAyJaDjAb+vd/RgWupGOxaZ79PKBHRtZTim+xgC5aCUPkpGlQt5Lw5TlA==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/powershell.min.js" integrity="sha512-PwV5Q67iPMuWqs6aDWCmrGm7keyzorPmleIF2Qe27hvQIvwxL7RUSCR4ChRjTZYYMM60FxrGOOhudyNYhqTdYw==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/scss.min.js" integrity="sha512-E2Gmd9vH0BXoGHlWshFIjW985slDBATPs4P4OJo9vK9zBvvKUJsQTDTuQAPaZ2xiDAvL6gZ7j9tdj1Nx8I6/8g==" crossorigin="anonymous">//</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/xml.min.js" integrity="sha512-dICltIgnUP+QSJrnYGCV8943p3qSDgvcg2NU4W8IcOZP4tdrvxlXjbhIznhtVQEcXow0mOjLM0Q6/NvZsmUH4g==" crossorigin="anonymous">//</script>
    <script>
                  hljs.initHighlightingOnLoad();
              </script>
  </body>
</html>