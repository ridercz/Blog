<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Jak rozběhnout synchronizační software Syncthing na Windows i na Linuxu | ALTAIR.blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="cs-CZ" />
    <link rel="canonical" href="https://www.altair.blog/2024/05/syncthing-linux" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/6.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="/content/styles.min.css?sha=86D6BE2BECADA8998ACB7999F797DEF1103C76B2" />
    <link rel="stylesheet" type="text/css" href="/content/fa-6.5.1/css/all.min.css" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed.rss" title="RSS (všechny články)" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed-internal.rss" title="RSS (pouze místní články)" />
    <link rel="alternate" type="application/rss+xml" href="https://www.altair.blog/feed-external.rss" title="RSS (pouze odkazy)" />
    <link rel="shortcut icon" href="https://www.altair.blog/favicon.ico" />
    <link rel="icon" href="https://www.altair.blog/favicon.ico" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@ridercz" />
    <meta name="twitter:title" content="Jak rozběhnout synchronizační software Syncthing na Windows i na Linuxu" />
    <meta name="twitter:description" content="Na synchronizaci dat mezi počítači používám nástroj Syncthing. Na kanálu Z-TECH o něm vytvářím seriál a nabízím vám návod, jak ho rozběhnout na Windows i na Linuxu." />
    <meta name="twitter:image" content="https://www.altair.blog/cover-pictures/20240514-syncthing-linux.jpg" />
    <meta property="article:published_time" content="2024-05-14" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="ALTAIR.blog" />
    <meta name="author" content="Michal Altair Valášek" />
    <meta name="title" property="og:title" content="Jak rozběhnout synchronizační software Syncthing na Windows i na Linuxu" />
    <meta name="description" property="og:description" content="Na synchronizaci dat mezi počítači používám nástroj Syncthing. Na kanálu Z-TECH o něm vytvářím seriál a nabízím vám návod, jak ho rozběhnout na Windows i na Linuxu." />
    <meta name="image" property="og:image" content="https://www.altair.blog/cover-pictures/20240514-syncthing-linux.jpg" />
    <meta property="og:locale" content="cs_CZ" />
    <meta property="og:url" content="https://www.altair.blog/2024/05/syncthing-linux" />
    <script>
      (function(f, a, t, h, o, m){
        a[h]=a[h]||function(){
          (a[h].q=a[h].q||[]).push(arguments)
        };
        o=f.createElement('script'),
        m=f.getElementsByTagName('script')[0];
        o.async=1; o.src=t; o.id='fathom-script';
        m.parentNode.insertBefore(o,m)
      })(document, window, '//stats.altair.blog/tracker.js', 'fathom');
      fathom('set', 'siteId', 'OBOTR');
      fathom('trackPageview');
    </script>
    <script src="/content/scripts/autocorrect.js?sha=3D24FB150C3151FFF3B9BFCA112E1A8B2F32B377" defer="defer" onload="typo.runAutoCorrector({number: false})">//</script>
    <meta name="robots" content="index, follow" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css" integrity="sha512-hasIneQUHlh06VNBe7f6ZcHmeRTLIaQWFd43YriJ0UND19bvYRauxthDg8E4eVNPm9bRUhr5JGeqH7FRFXQu5g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body class="hascover" style="background-image: url(/cover-pictures/20240514-syncthing-linux.jpg)">
    <header>
      <div>
        <a href="/">
          <img src="/content/images/logo_onblack.svg" alt="altair.blog" style="max-height:100px;max-width:80%" />
        </a>
      </div>
    </header>
    <nav>
      <ul>
        <li>
          <a href="https://www.rider.cz/" title="Autor: Michal Altair Valášek">
            <i class="fal fa-fw fa-user"> </i>
          </a>
        </li>
        <li>
          <a href="/archive" title="Archiv článků">
            <i class="fal fa-fw fa-archive"> </i>
          </a>
        </li>
        <li>
          <a href="/categories" title="Rubriky">
            <i class="fal fa-fw fa-tags"> </i>
          </a>
        </li>
        <li>
          <a href="/serials" title="Seriály">
            <i class="fal fa-fw fa-list-alt"> </i>
          </a>
        </li>
        <li>
          <a href="/search" title="Vyhledávání">
            <i class="fal fa-fw fa-search"> </i>
          </a>
        </li>
        <li>
          <a href="https://www.rider.cz/#contact" title="Kontakt">
            <i class="fal fa-fw fa-envelope"> </i>
          </a>
        </li>
        <li>
          <a href="https://facebook.com/rider.cz" title="Facebook">
            <i class="fab fa-fw fa-facebook"> </i>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/ridercz" title="Twitter">
            <i class="fab fa-twitter"> </i>
          </a>
        </li>
        <li>
          <a href="https://github.com/ridercz" title="Github">
            <i class="fab fa-fw fa-github"> </i>
          </a>
        </li>
        <li>
          <a href="https://ask.fm/ridercz" title="Ask.fm">
            <i class="fal fa-fw fa-question"> </i>
          </a>
        </li>
      </ul>
    </nav>
    <main>
      <h1>Jak rozběhnout synchronizační software Syncthing na Windows i na Linuxu</h1>
      <aside class="article-info">
        <ul class="categories">
          <li>
            <a href="/categories/it" title="Rubrika">
              <i class="fal fa-tag"> </i>IT</a>
          </li>
          <li>
            <a href="/categories/lab" title="Rubrika">
              <i class="fal fa-tag"> </i>Lab</a>
          </li>
          <li>
            <a href="/categories/linux" title="Rubrika">
              <i class="fal fa-tag"> </i>Linux</a>
          </li>
        </ul>
        <div title="Autor">
          <a href="https://www.rider.cz/">Michal Altair Valášek </a>
          <i class="fal fa-fw fa-user">​</i>
        </div>
        <div title="Datum vydání">
          <time datetime="2024-05-14">14. května 2024 <i class="fal fa-fw fa-calendar-lines">​</i></time>
        </div>
      </aside>
      <section class="article-text">
        <p>Na synchronizaci dat mezi počítači používám bezplatný a otevřený nástroj <a href="https://syncthing.net/">Syncthing</a>. Dříve jsem používal Resilio Sync, ale poté co změnili licenční politiku a pro běh na serverovém OS je třeba měsíční platba, přešel jsem právě na Syncthing. A na kanálu Z-TECH jsem o něm vytvořil seriál:</p>
<ol>
<li><a href="https://youtu.be/khn4ki850nE">Základní představení a instalace na Windows</a></li>
<li><a href="https://youtu.be/S9OFykSyvAU">Instalace na Linux a Raspberry Pi</a></li>
<li><a href="https://youtu.be/xdUcCBodx9s">Pokročilejší nastavení synchronizace</a></li>
<li><a href="https://youtu.be/H2m47dAi9q4">Instalace na Windows jako služba</a></li>
</ol>
<p>Instalace na Windows je poměrně přímočará, ale na Linuxu je to o něco složitější, je tam více manuálních kroků. Proto jsem připravil návod krok za krokem.</p>
<h2>Instalace aplikace Syncthing na Linuxu</h2>
<div style="position:relative;padding-top:56.25%;">
  <iframe src="https://www.youtube-nocookie.com/embed/S9OFykSyvAU" frameborder="0" allowfullscreen allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
</div>
<p>Tento návod popisuje, jak nainstalovat synchronizační software na Linux. Počítá s následujícími distribucemi, aktuálními ke dni vydání článku:</p>
<ul>
<li><strong>Ubuntu Linux</strong> 24.04 LTS</li>
<li><strong>Raspberry Pi OS</strong> 2024-03-15 (Debian 12 - Bookworm)</li>
</ul>
<p>Z mého pohledu je důležitá zejména instalace na Raspberry Pi, protože pomocí něj a externího disku (ukážu vám, jak ho zprovoznit) si můžete jednoduše vytvořit off-site zálohu. V práci, u známého, kdekoliv kde je připojení k Internetu, si můžete jednoduše vytvořit zálohovací server, který ochrání vaše data i v případě, že by primární lokace byla zničena, například požárem.</p>
<p>Návodů na zprovoznění Syncthingu na Linuxu jsem našel spoustu, ale mají z mého pohledu dvě zásadní vady z hlediska bezpečnosti:</p>
<ul>
<li>Syncthing běží pod rootem, nebo pod uživatelem s vysokými oprávněními. Můj návod počítá s vytvořením speciálního uživatele s nízkými právy.</li>
<li>Jeho webové administrační rozhraní je dostupné přímo z vnější sítě (případně z Internetu). Můj návod schovává rozhraní za nginx proxy.</li>
</ul>
<h3>Základní instalace</h3>
<table class="steps">
<tr data-step-seqid="1" data-step-sha256="TGuqUAakwSwZf//0PZ9nBmb46Q9hCZcKMVnUV9+S+b0">
	<th>1.</th>
	<td><p>Připojte se na server z konzole nebo přes SSH.</p></td>
</tr>
<tr data-step-seqid="2" data-step-sha256="NmT7F+temn5B1XMmlsVV1Hhfeb1Cmcb31JjJy+El3RQ">
	<th>2.</th>
	<td><p>Následujícími příkazy plně aktualizujte systém</p>
<pre><code>sudo apt-get update &amp;&amp; sudo apt-get upgrade -y</code></pre>
<p>Vyčkejte, dokud vše neproběhne, což může v závislosti na rychlosti vašeho připojení a počítače trvat i několik desítek minut.</p></td>
</tr>
</table>
<h3>Instalace aplikace Syncthing</h3>
<table class="steps">
<tr data-step-seqid="3" data-step-sha256="wxKbqpcA+sS9dJWZb9JlIwwTgvYtRqmG32IPDlwC1Ms">
	<th>3.</th>
	<td><p>Přidejte klíč APT repository Syncthingu mezi důvěryhodné:</p>
<pre><code>curl -s https://syncthing.net/release-key.txt | gpg --dearmor | sudo tee /usr/share/keyrings/syncthing-archive-keyring.gpg &gt;/dev/null</code></pre></td>
</tr>
<tr data-step-seqid="4" data-step-sha256="7OJDloDCodCyaa4cVhFiX17RAZgUSy0CS37GSI2EImA">
	<th>4.</th>
	<td><p>Přidejte repository do systému:</p>
<pre><code>echo &quot;deb [signed-by=/usr/share/keyrings/syncthing-archive-keyring.gpg] https://apt.syncthing.net/ syncthing stable&quot; | sudo tee /etc/apt/sources.list.d/syncthing.list</code></pre></td>
</tr>
<tr data-step-seqid="5" data-step-sha256="nS3OWFuOZzBeviiAXjvrDjvkq86xuaRBw4roTc68vw4">
	<th>5.</th>
	<td><p>Aktualizujte seznam dostupných balíčků:</p>
<pre><code>sudo apt-get update</code></pre></td>
</tr>
<tr data-step-seqid="6" data-step-sha256="woomBzzOXxU1Zqgcmgj6EVf4Ug+MWPkZjpze6yDQszw">
	<th>6.</th>
	<td><p>Nainstalujte aplikaci Syncthing:</p>
<pre><code>sudo apt-get install syncthing -y</code></pre></td>
</tr>
</table>
<h3>Vytvoření uživatele</h3>
<p>Chceme, aby aplikace běžela nikoliv pod rootem (nebo jiným uživatelem s vysokými právy), ale pod svým vlastním uživatelem <code>syncthing</code> s minimálními oprávněními.</p>
<table class="steps">
<tr data-step-seqid="7" data-step-sha256="tkdNBnczMZXJbSiiA4h8FLvqeU+NwnfOfkDGnKHm9mw">
	<th>7.</th>
	<td><p>Následujícím příkazem vytvoříte pro službu uživatele:</p>
<pre><code>sudo adduser --disabled-password --gecos &quot;Syncthing service&quot; syncthing</code></pre></td>
</tr>
<tr data-step-seqid="8" data-step-sha256="4KlxMJrfmf41zHWeUFTUNHjlj26JGXh2CoZuaTh2Bis">
	<th>8.</th>
	<td><p>Přepněte se do kontextu tohoto uživatele:</p>
<pre><code>sudo su syncthing</code></pre></td>
</tr>
<tr data-step-seqid="9" data-step-sha256="HDWLK7n2kFNEWfYEY+/tDV9ncPo8B+usufHJUyIQ5lw">
	<th>9.</th>
	<td><p>Spusťte z konzole Syncthing, aby se vytvořila konfigurace:</p>
<pre><code>syncthing</code></pre></td>
</tr>
<tr data-step-seqid="10" data-step-sha256="fB9NUE/1C3mI+r6vPMtuOJi2+ijIhemDbValL/2Bdlk">
	<th>10.</th>
	<td><p>Měli byste vidět log, zhruba jako na následujícím obrázku:</p>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-01.png" alt="" /></p>
<p>Ukončete aplikaci stiskem <em>Ctrl+C</em>.</p></td>
</tr>
<tr data-step-seqid="11" data-step-sha256="mNj1hYp1x98+yPrSJGpK6sM74LwTPFGdvfogUwHlQWo">
	<th>11.</th>
	<td><p>Opusťte kontext uživatele služby:</p>
<pre><code>exit</code></pre></td>
</tr>
</table>
<h3>Konfigurace aplikace a registrace daemona</h3>
<p>Protože budeme chtít webové rozhraní aplikace publikovat do Internetu pomocí nginxu, je třeba provést změnu v konfiguraci, aby fungovala publikace pomocí proxy. Také je nutné nastavit Syncthing jako daemona, automaticky spouštěnou aplikaci běžící na pozadí.</p>
<table class="steps">
<tr data-step-seqid="12" data-step-sha256="ANl1X8ifzkWZR60BF2MBidAPcfKYgxzzxyQhbhSQuKw">
	<th>12.</th>
	<td><p>Otevřete konfigurační soubor v editoru Nano:</p>
<pre><code>sudo nano /home/syncthing/.local/state/syncthing/config.xml</code></pre></td>
</tr>
<tr data-step-seqid="13" data-step-sha256="n0HpYEv822ClB1Bx/uG0gnXjMAsIyokq0cRzONrQVKM">
	<th>13.</th>
	<td><p>Najděte v XML dokumentu element <code>/configuration/gui</code> a přidejte do něj následující element:</p>
<pre><code>&lt;insecureSkipHostcheck&gt;true&lt;/insecureSkipHostcheck&gt;</code></pre>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-02.png" alt="" /></p></td>
</tr>
<tr data-step-seqid="14" data-step-sha256="xfgy9hx1YdaNAbucvwxiHpJry3/O32Q+qalR+17UC+c">
	<th>14.</th>
	<td><p>Stiskem <em>Ctrl+S</em> uložte změny a stiskem <em>Ctrl+X</em> ukončete editor.</p></td>
</tr>
<tr data-step-seqid="15" data-step-sha256="NWw25tsca6Ee7b8wyBM9YgVW3UOYG4vf6tFZzN/rKO0">
	<th>15.</th>
	<td><p>Vytvořte v editoru Nano soubor s definicí služby:</p>
<pre><code>sudo nano /lib/systemd/system/syncthing.service</code></pre></td>
</tr>
<tr data-step-seqid="16" data-step-sha256="ommCr1QmvEV8pQ9qDOS2DZYXOlj8ZsFc1CbgptQvifY">
	<th>16.</th>
	<td><p>Zadejte do něj následující text:</p>
<pre><code>[Unit]
Description=Syncthing
Documentation=man:syncthing(1)
After=network.target

[Service]
User=syncthing
WorkingDirectory=/home/syncthing
ExecStart=/usr/bin/syncthing -no-browser -no-restart -logflags=0
Restart=on-failure
RestartSec=5
SuccessExitStatus=3 4
RestartForceExitStatus=3 4
SyslogIdentifier=syncthing
ProtectSystem=full
PrivateTmp=true
SystemCallArchitectures=native
MemoryDenyWriteExecute=true
NoNewPrivileges=true

[Install]
WantedBy=multi-user.target</code></pre></td>
</tr>
<tr data-step-seqid="17" data-step-sha256="xfgy9hx1YdaNAbucvwxiHpJry3/O32Q+qalR+17UC+c">
	<th>17.</th>
	<td><p>Stiskem <em>Ctrl+S</em> uložte změny a stiskem <em>Ctrl+X</em> ukončete editor.</p></td>
</tr>
<tr data-step-seqid="18" data-step-sha256="Z8kHyF0IpOL04Ke/4dPkZxs7L0rTRdN57hL8Bqyq8Jg">
	<th>18.</th>
	<td><p>Následujícími příkazy službu zaregistrujte a nastartujte:</p>
<pre><code>sudo systemctl enable syncthing
sudo systemctl start syncthing</code></pre></td>
</tr>
<tr data-step-seqid="19" data-step-sha256="8iOYy+2h8MF9CE5fNFTUJzTGf068yHwEWDVtinyStu8">
	<th>19.</th>
	<td><p>Následujícím příkazem si ověřte, že úspěšně běží (je tam <code>Active: active (running)</code> jako na obrázku):</p>
<pre><code>sudo systemctl status syncthing</code></pre>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-03.png" alt="" /></p></td>
</tr>
<tr class="information">
	<th><i class="fal fa-info-circle"></i></th>
	<td><p>Nyní již Syncthing běží a mohli byste se k němu připojit pomocí adresy <code>http://127.0.0.1:8384</code> - ale jenom z lokálního počítače, ne zvenčí.</p></td>
</tr>
</table>
<h3>Publikace pomocí nginxu</h3>
<p>Nechceme, aby byl Syncthing do sítě (Internetu) vystaven přímo, ale prostřednictvím proxy nginx. Z bezpečnostních důvodů a i z důvodů praktických -- například je výrazně jednodušší nastavit automatické vystavení a obnovování HTTPS certifikátů od Let's Encrypt CA pro nginx než přímo pro Syncthing.</p>
<table class="steps">
<tr data-step-seqid="20" data-step-sha256="EgtdupKNmeq5FbrmNPnwG1cDqk1CrhnU2CCqAWBG7zo">
	<th>20.</th>
	<td><p>Nainstalujte nginx:</p>
<pre><code>sudo apt-get install nginx -y</code></pre></td>
</tr>
<tr data-step-seqid="21" data-step-sha256="KNA0IGD3uOyy6mMkkSv4s8GVpB6SvnsMSbxS9wBebNI">
	<th>21.</th>
	<td><p>Vytvořte v editoru Nano konfigurační soubor pro naši site:</p>
<pre><code>sudo nano /etc/nginx/sites-available/syncthing</code></pre></td>
</tr>
<tr data-step-seqid="22" data-step-sha256="wnPI4PxgTaM1E8B/oFXbB6j99HObOGFMa8+uIsn1dFM">
	<th>22.</th>
	<td><p>Zadejte do něj následující obsah:</p>
<pre><code>server {
    listen 80;
    location / {
        proxy_pass http://localhost:8384;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}</code></pre></td>
</tr>
<tr data-step-seqid="23" data-step-sha256="xfgy9hx1YdaNAbucvwxiHpJry3/O32Q+qalR+17UC+c">
	<th>23.</th>
	<td><p>Stiskem <em>Ctrl+S</em> uložte změny a stiskem <em>Ctrl+X</em> ukončete editor.</p></td>
</tr>
<tr data-step-seqid="24" data-step-sha256="SBkiH+LCy1X9yD7MYmfyDzaZFim47IwY4u9KC+dsHbo">
	<th>24.</th>
	<td><p>Zakažte výchozí demo site a povolte nově vytvořenou site pro Syncthing:</p>
<pre><code>sudo rm /etc/nginx/sites-enabled/default
sudo ln /etc/nginx/sites-available/syncthing /etc/nginx/sites-enabled/syncthing</code></pre></td>
</tr>
<tr data-step-seqid="25" data-step-sha256="bMa6DJLX0Lo01/1UOWYh0FhuWR4voI711m1shDcGnFM">
	<th>25.</th>
	<td><p>Reloadněte konfiguraci nginxu:</p>
<pre><code>sudo nginx -s reload</code></pre></td>
</tr>
</table>
<h3>Základní zabezpečení</h3>
<table class="steps">
<tr data-step-seqid="26" data-step-sha256="VXkqH2gIn7Hfg58TnXnhz1K3o2z0rti8/DywztGOyYo">
	<th>26.</th>
	<td><p>Podívejte se v prohlížeči na IP adresu nebo název vašeho serveru. Zobrazí se vám webové GUI aplikace Syncthing:</p>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-04.png" alt="" /></p></td>
</tr>
<tr id="userinfo" data-step-seqid="27" data-step-sha256="V8wkUuVM4M0iY49CFaPJfE3Zps/fps3AtHKcKgUr9CQ">
	<th>27.</th>
	<td><p>V tomto okamžiku není nastaveno pro webové rozhraní žádné uživatelské jméno a heslo.</p>
<ol>
<li>Klepněte na odkaz <em>Settings</em>.</li>
<li>Vyberte záložku <em>GUI</em>.</li>
<li>Vyplňte požadované uživatelské jméno.</li>
<li>Vyplňte požadované heslo.</li>
<li>Klepněte na <em>Save</em>.</li>
</ol>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-05.png" alt="" /></p></td>
</tr>
<tr class="warning">
	<th><i class="fal fa-exclamation-triangle"></i></th>
	<td><p>Po klepnutí na <em>Save</em> se Syncthing restartuje, což chvíli trvá. Nenechte se zmást chybovými hlášeními jako například <em>502 Gateway Timeout</em>. Chvíli vyčkejte a obnovte stránku.</p></td>
</tr>
<tr data-step-seqid="28" data-step-sha256="iiZ/GZ8P1zk+L70xQvxwYOjZuTfkd8RFmA7tFUqEKTI">
	<th>28.</th>
	<td><p>Nyní budete před vstupem do uživatelského rozhraní vyzváni k zadání jména a hesla, které jste zvolili v kroku <a href="#userinfo">27</a>.</p></td>
</tr>
<tr data-step-seqid="29" data-step-sha256="k10O9O123JDLyZsRt85PxTaKW9e0RSbzAHTS8MzugC4">
	<th>29.</th>
	<td><p>Abychom zvýšili zabezpečení celého systému, nastavíme pravidla na firewallu tak, aby byly povoleny pouze vybrané porty. Nainstalujte Uncomplicated firewall (UFW):</p>
<pre><code>sudo apt-get install ufw -y</code></pre></td>
</tr>
<tr class="information">
	<th><i class="fal fa-info-circle"></i></th>
	<td><p>Instalace UFW není nezbytná, lze přímo konfigurovat iptables, ale to není dvakrát pohodlné, proto je lepší toto jednoduché rozhraní.</p></td>
</tr>
<tr data-step-seqid="30" data-step-sha256="VhANC0+SPKKpOfDl4I1+4SQBVaN8gIwCGI8catI61MA">
	<th>30.</th>
	<td><p>Následujícími příkazy povolíte porty 22, 80 a 443:</p>
<pre><code>sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp</code></pre></td>
</tr>
<tr data-step-seqid="31" data-step-sha256="x6jIqtQk5bmZKToADI3PTqfBT2JyFTce2eH7o+SomrU">
	<th>31.</th>
	<td><p>Následujícím příkazem firewall aktivujete:</p>
<pre><code>sudo ufw enable</code></pre>
<p>Na dotaz <code>Command may disrupt existing ssh connections. Proceed with operation (y|n)?</code> odpovězte <code>y</code>.</p></td>
</tr>
<tr data-step-seqid="32" data-step-sha256="IKySeVJY6B2YAcxOHtui3hyXLVRypwnpRdR0fr+K4O0">
	<th>32.</th>
	<td><p>Následujícím příkazem restartujte server a ověřte si, že všechny služby po rebootu řádně nastartovaly:</p>
<pre><code>sudo reboot now</code></pre></td>
</tr>
</table>
<h3>Instalace dalšího disku</h3>
<p>Syncthing nám úspěšně běží a můžeme s ním běžným způsobem pracovat. Nicméně v případě Raspberry Pi máme k dispozici pouze úložiště na paměťové kartě, což není ideální. Následujícím postupem lze připojit k Raspberry externí disk pomocí USB a zpřístupnit ho pro použití Syncthingem.</p>
<table class="steps">
<tr class="information">
	<th><i class="fal fa-info-circle"></i></th>
	<td><p>Tento postup předpokládá, že disk je zcela nový, prázdný, bez partitions atd. Pokud tomu tak není, budete v kroku <a href="#partition">38</a> muset nejprve smazat existující partitions.</p></td>
</tr>
<tr data-step-seqid="33" data-step-sha256="vg+MI3iS9dzyDNp5dVscX2e63oyotY8irpBq9JPKjNk">
	<th>33.</th>
	<td><p>Nejprve zjistěte, jak se váš disk systémově jmenuje. To záleží na mnoha okolnostech, ale typicky to bude <code>/dev/sda</code> (na Raspberry Pi, které nabootovalo z MicroSD karty a má připojený nový disk přes USB), <code>/dev/sdb</code> (na běžném PC, které má jeden systémový disk a jeden nový přes USB nebo SATA) a podobně.</p></td>
</tr>
<tr class="warning">
	<th><i class="fal fa-exclamation-triangle"></i></th>
	<td><p>Je velmi důležité si být jisti, že pracujete se správným diskem! Pokud budete příkazy volat proti špatnému disku, přijdete o veškerá data na něm!</p></td>
</tr>
<tr data-step-seqid="34" data-step-sha256="5UgabZSJPY1lL+QttyJrWngYnw1Nrqc6tp2WDaEEszY">
	<th>34.</th>
	<td><p>Následujícím příkazem si vypište seznam všech disků:</p>
<pre><code>sudo fdisk -l</code></pre></td>
</tr>
<tr data-step-seqid="35" data-step-sha256="V2Foet7ZJpjgDEa4Uq0yCJo/BTm9U53OAoz5TFlw/nk">
	<th>35.</th>
	<td><p>Najděte svůj disk. Poznáte jej podle velikosti (zde <em>931,51 GiB</em>) a modelu (zde <em>024 HN-M101MBB</em>). Pro náš případ se tento disk jmenuje <code>/dev/sda</code>.</p>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-06.png" alt="" /></p></td>
</tr>
<tr class="warning">
	<th><i class="fal fa-exclamation-triangle"></i></th>
	<td><p>Pokud se váš disk jmenuje jinak, musíte <code>/dev/sda</code> v následujících příkazech nahradit za váš název.</p></td>
</tr>
<tr data-step-seqid="36" data-step-sha256="zkTXmrr+E6eJu8MnyCNLgoMonGbQWk0jTDh2L1h7SwE">
	<th>36.</th>
	<td><p>Spusťte interaktivní aplikaci pro vytvoření partitions cfdisk:</p>
<pre><code>sudo cfdisk /dev/sda</code></pre></td>
</tr>
<tr data-step-seqid="37" data-step-sha256="dOSxHHocxT4gRYHp7OC8rphGby3+waxlDRKMOyQY3Rs">
	<th>37.</th>
	<td><p>Jako label type zvolte výchozí hodnotu <code>gpt</code> (stačí stisknout <em>Enter</em>).</p>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-07.png" alt="" /></p></td>
</tr>
<tr id="partition" data-step-seqid="38" data-step-sha256="NE6klYOQAEgzqDqhzhwx9DmP3s78SdH4RUWlWE1yeCU">
	<th>38.</th>
	<td><p>Pokud je váš disk prázdný, uvidíte pouze informaci <em>Free space</em>. Pokud by na něm byly partitions, musíte všechny smazat (<em>Delete</em>), dokud se do tohoto stavu nedostanete.</p>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-08.png" alt="" /></p></td>
</tr>
<tr data-step-seqid="39" data-step-sha256="8zrwHsVIotfqGbtNzD4iSnlUClf9oyt0xS0gLlN5ddc">
	<th>39.</th>
	<td><p>Šipkami vyberte <em>New</em> a klepněte na <em>Enter</em>.</p></td>
</tr>
<tr data-step-seqid="40" data-step-sha256="EJYD9S13z/jAr52uVt6e4/GG+jz8Vp0fVUW77L52mCI">
	<th>40.</th>
	<td><p>Potvrďte výchozí velikost (použije se celý disk) tím, že klepnete na <em>Enter</em>.</p></td>
</tr>
<tr data-step-seqid="41" data-step-sha256="spggBeDOjURjSjaEPsWWPMvi0eHwTUNRecUfguqH44Q">
	<th>41.</th>
	<td><p>Vyberte <em>Write</em>. Na otázku <em>Are you sure you want to write the partition table to disk?</em> odpovězte <code>yes</code> a <em>Enter</em>.</p></td>
</tr>
<tr data-step-seqid="42" data-step-sha256="Rw8olM+Cbu12jqR1Lv7rjdJeXwkpIVmuIfHaFo4cNNE">
	<th>42.</th>
	<td><p>Podívejte se, jak se jmenuje nově vytvořená partition. Zde <code>/dev/sda1</code>. Poté vyberte <em>Quit</em> a ukončete cfdisk.</p>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-09.png" alt="" /></p></td>
</tr>
<tr class="warning">
	<th><i class="fal fa-exclamation-triangle"></i></th>
	<td><p>Pokud se vaše partition jmenuje jinak, musíte <code>/dev/sda1</code> v následujících příkazech nahradit za váš název.</p></td>
</tr>
<tr data-step-seqid="43" data-step-sha256="87V9sacgv/OXduuBMbx2GfzFZ4Y1BW4Rlb/tamraqPA">
	<th>43.</th>
	<td><p>Následujícím příkazem partition naformátujte na souborový systém EXT4. První parametr (<code>-L /syncthing-data</code>) je label disku, který může být jakýkoliv. Druhý parametr je název partition zjištěný v předchozím kroku.</p>
<pre><code>sudo mkfs.ext4 -L /syncthing-data /dev/sda1</code></pre></td>
</tr>
<tr class="information">
	<th><i class="fal fa-info-circle"></i></th>
	<td><p>Pokud budete vyzváni k přepsání existující partition, odpovězte <code>y</code> a <em>Enter</em>. Formátování bude chvíli trvat, buďte trpěliví.</p></td>
</tr>
<tr data-step-seqid="44" data-step-sha256="KFOpG6q5BdQTWqNuhsu/EmvcM9BayQhjJHbDnsoANTs">
	<th>44.</th>
	<td><p>Vytvořte prázdný adresář <code>/syncthing-data</code>:</p>
<pre><code>sudo mkdir /syncthing-data</code></pre></td>
</tr>
<tr data-step-seqid="45" data-step-sha256="kmXbrAUzncbbhGdFRrpRhjiLUw531PjorDSmQjMqW2E">
	<th>45.</th>
	<td><p>Přimountujte novou partition do tohoto adresáře:</p>
<pre><code>sudo mount /dev/sda1 /syncthing-data</code></pre></td>
</tr>
<tr class="information">
	<th><i class="fal fa-info-circle"></i></th>
	<td><p>Nyní je váš disk dostupný pro operační systém. Můžete se o tom přesvědčit příkazem <code>ls -la /syncthing-data</code>. Pokud je vše správně, uvidíte tam systémový adresář <code>lost+found</code>.</p></td>
</tr>
<tr data-step-seqid="46" data-step-sha256="t5a+KvyQGUAEa5VTRF90ukOUdETgYMs/vFR8WAZbvBQ">
	<th>46.</th>
	<td><p>Učiňte uživatele <code>syncthing</code> vlastníkem adresáře a tedy celého disku:</p>
<pre><code>sudo chown -R syncthing: /syncthing-data</code></pre></td>
</tr>
<tr data-step-seqid="47" data-step-sha256="iZmEi9amdy1fzJ0tqq1M4CoNTFMWD1XAvWpsYcWy48g">
	<th>47.</th>
	<td><p>Zakažte přístup komukoliv kromě vlastníka:</p>
<pre><code>sudo chmod go-rwx /syncthing-data</code></pre></td>
</tr>
<tr data-step-seqid="48" data-step-sha256="uN0yMizy5bUtRmC5JStmruwm0RCkyKBeCGE9T0NlfCk">
	<th>48.</th>
	<td><p>Nyní všechno funguje, ale po rebootu přestane. Aby byl disk funkční i po restartu (automaticky se přimountoval), editujte soubor <code>/etc/fstab</code>:</p>
<pre><code>sudo nano /etc/fstab</code></pre></td>
</tr>
<tr data-step-seqid="49" data-step-sha256="Zj6/pIltvsdOi3exAGQZthbaDFsgAVZt9j0yAQkmAsk">
	<th>49.</th>
	<td><p>Přidejte na konec souboru následující řádek (oddělovač je tabulátor):</p>
<pre><code>/dev/sda1       /syncthing-data ext4    defaults        0       0</code></pre>
<p><img src="https://www.cdn.altairis.cz/Blog/2024/20240514-syncthing-10.png" alt="" /></p></td>
</tr>
<tr data-step-seqid="50" data-step-sha256="xfgy9hx1YdaNAbucvwxiHpJry3/O32Q+qalR+17UC+c">
	<th>50.</th>
	<td><p>Stiskem <em>Ctrl+S</em> uložte změny a stiskem <em>Ctrl+X</em> ukončete editor.</p></td>
</tr>
<tr data-step-seqid="51" data-step-sha256="nQvuyJBstNMHwM2+J5WYRR2AA+3klzqct9lE/qKK7sw">
	<th>51.</th>
	<td><p>Následujícím příkazem restartujte server:</p>
<pre><code>sudo reboot now</code></pre></td>
</tr>
<tr data-step-seqid="52" data-step-sha256="pl/i0PoHsA/8pfCao180aXzbXr+F6TRsMMXo/2U6s3g">
	<th>52.</th>
	<td><p>Po restartu se přesvědčte, že je disk řádně namountován (uvidíte v něm jako root adresář <code>lost+found</code>). Pokud ano, můžete nový disk zdárně používat v aplikaci Syncthing.</p></td>
</tr>
</table>

      </section>
      <section class="issues">
        <header>
          <i class="fab fa-github">​</i> Je v článku něco špatně? Chcete něco doplnit?</header>
        <p>Komentáře zde nenajdete, ale pokud je v článku chyba nebo k němu chcete něco věcného doplnit, můžete na GitHubu <a href="https://github.com/ridercz/Blog/issues/new?title=Jak+rozb%c4%9bhnout+synchroniza%c4%8dn%c3%ad+software+Syncthing+na+Windows+i+na+Linuxu&amp;body=https://www.altair.blog/2024/05/syncthing-linux">otevřít nový issue</a> nebo <a href="https://github.com/ridercz/Blog/edit/master/source/2024/05/syncthing-linux.md">navrhnout změnu v textu</a> a poslat mi pull request.</p>
        <p>Tamtéž také najdete <a href="https://github.com/ridercz/Blog/commits/master/source/2024/05/syncthing-linux.md">historii všech verzí článku</a>, pokud v něm byly provedeny nějaké změny či úpravy.</p>
      </section>
      <section class="sharing">
        <span>Pošli to dál:</span>
        <ul>
          <li>
            <a href="https://twitter.com/intent/tweet?text=https://www.altair.blog/2024/05/syncthing-linux">
              <i class="fab fa-x-twitter">​</i>
            </a>
          </li>
          <li>
            <a href="https://www.facebook.com/sharer.php?u=https://www.altair.blog/2024/05/syncthing-linux">
              <i class="fab fa-facebook-f">​</i>
            </a>
          </li>
        </ul>
      </section>
    </main>
    <footer>
      <ul class="logos">
        <li>
          <img src="/content/images/logo_onwhite.svg" alt="altair.blog" style="height:38px;" />
        </li>
      </ul>
      <ul class="text">
        <li>
          Copyright © <a href="https://www.rider.cz/">Michal Altair Valášek</a>, 2003-2025</li>
        <li>
          Powered by <a href="https://www.xml4web.com/">XML4web</a> on <a href="https://www.github.com/">GitHub Pages</a></li>
        <li>
          <i class="fal fa-rss">​</i> RSS: <a href="/feed.rss">všechno</a> | <a href="/feed-internal.rss">místní</a> | <a href="/feed-external.rss">odkazy</a></li>
      </ul>
    </footer>
  </body>
</html>