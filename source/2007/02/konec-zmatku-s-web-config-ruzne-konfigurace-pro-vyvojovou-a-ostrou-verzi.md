<!-- dcterms:identifier = aspnetcz#140 -->
<!-- dcterms:title = Konec zmatku s web.config: různé konfigurace pro vývojovou a ostrou verzi -->
<!-- dcterms:abstract = Známe to všichni: při nahrávání nové verze aplikace je třeba čarovat s web.configem, měnit connection stringy a jiné parametry... Web Deployment Projects nabízejí vestavěné řešení, které ale pokládám za poněkud nešikovné. Lze je ale "přiohnout" a usnadnit si život. -->
<!-- np9:categoryId = 1 -->
<!-- x4w:category = Programování -->
<!-- np9:authorId = 1 -->
<!-- np9:authorEmail = michal.valasek@altairis.cz -->
<!-- dcterms:creator = Michal Altair Valášek -->
<!-- dcterms:created = 2007-02-13T16:30:39.613+01:00 -->
<!-- dcterms:dateAccepted = 2007-02-13T16:30:39.613+01:00 -->

 <p>Známe to všichni: nová verze aplikace je hotová je je "jenom" potřeba ji nahrát na ostrý server a zprovoznit. Což mimo jiné znamená upravit web.config: connection stringy pro připojení do databáze, e-mailové adresy a další parametry.</p><p><a href="http://msdn2.microsoft.com/en-us/asp.net/aa336619.aspx">Visual Studio 2005 Web Deployment Projects</a> nabízejí jisté řešení. Lze definovat pravidla, kdy se mají různé sekce web.configu nahradit daty z jiných XML souborů. Přiznám se, že tomu řešení jsem moc na chuť nepřišel, protože mi přijde příliš komplikované, navíc se mi nikdy nepodařilo ho rozchodit, jak jsem potřeboval.</p><p>Používám jiné řešení: v aplikaci mám soubor <em>Web.Config</em> (obsahuje nastavení pro vývoj) a soubor <em>Web.Production.Config</em>, který obsahuje nastavení pro provoz na ostrém serveru. Jediné, co potřebuji udělat, je při nasazení na ostrém serveru smazat původní <em>Web.Config</em> a nahradit ho souborem <em>Web.Production.Config</em>.</p><p>I tuto činnost lze automatizovat. Deployment projekty jsou totiž standardní MSBuild projektové soubory, takže je lze libovolně modifikovat, přidávat různé akce, které mají proběhnout při buildu.</p><p>Když na název deployment projektu ve Visual Studiu klepnete pravým tlačítkem a z kontextového menu vyberete "Open project file", můžete editovat přímo XML soubor *.wdproj.</p><p>Na konec souboru (ale před <strong>&lt;/Project&gt;</strong>) můžete přidat element <strong>&lt;Target name="AfterBuild"&gt;</strong>, kde můžete specifikovat, jaké akce se mají provést po dokončení kompilace. Standardní akce zahrnují i práci se soubory. Shora uvedenou operaci tedy můžete automatizovat takto:</p><div style="FONT-SIZE: 11pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas, Courier New, monospace"><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">Target</span> <span style="COLOR: blue"></span><span style="COLOR: red">Name</span> <span style="COLOR: blue">=</span>"<span style="COLOR: blue">AfterBuild</span>"<span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">  &lt;</span><span style="COLOR: #a31515">Delete</span> <span style="COLOR: blue"></span><span style="COLOR: red">Files</span> <span style="COLOR: blue">=</span>"<span style="COLOR: blue">$(OutputPath)\Web.Config</span>"<span style="COLOR: blue"> /&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">  &lt;</span><span style="COLOR: #a31515">Copy</span> <span style="COLOR: blue"></span><span style="COLOR: red">SourceFiles</span> <span style="COLOR: blue">=</span>"<span style="COLOR: blue">$(OutputPath)\Web.Production.Config</span>"<span style="COLOR: blue"> </span><span style="COLOR: red">DestinationFiles</span><span style="COLOR: blue">=</span>"<span style="COLOR: blue">$(OutputPath)\Web.Config</span>"<span style="COLOR: blue"> /&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">  &lt;</span><span style="COLOR: #a31515">Delete</span> <span style="COLOR: blue"></span><span style="COLOR: red">Files</span> <span style="COLOR: blue">=</span>"<span style="COLOR: blue">$(OutputPath)\Web.Production.Config</span>"<span style="COLOR: blue"> /&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;/</span><span style="COLOR: #a31515">Target</span><span style="COLOR: blue">&gt;</span> </p></div><p>Možnosti jsou samozřejmě nepoměrně širší, oceníte je především v případě složitějších scénářů deploymentu. Podrobnější informace o nich najdete na <a href="http://msdn2.microsoft.com/en-us/ms171462.aspx">MSDN</a>.</p><!--EndFragment-->