<!-- dcterms:identifier = aspnetcz#206 -->
<!-- dcterms:title = System.IO.Packaging – vytváření datových “balíčků” dle OPC v .NET 3.5 -->
<!-- dcterms:abstract = Open Packaging Conventions (OPC) je standard, který popisuje postupy pro ukládání více datových objektů a jejich vzájemných vztahů v jednom fyzickém kontajneru (souboru). Nejčastější formou datového úložiště je ZIP soubor. Podíváme se, jak je možno s těmito soubory programově manipulovat, vytvářet je a číst. To lze použít pro práci s OpenXML formátem (Office 2007) a nebo pro vytváření vlastních datových úložišť. -->
<!-- np9:categoryId = 1 -->
<!-- x4w:category = Programování -->
<!-- np9:authorId = 1 -->
<!-- np9:authorEmail = michal.valasek@altairis.cz -->
<!-- dcterms:creator = Michal Altair Valášek -->
<!-- dcterms:created = 2008-08-02T15:27:06.627+02:00 -->
<!-- dcterms:dateAccepted = 2008-08-02T15:27:06.627+02:00 -->

<p>  <p>  <p>  <p>  <p>  <p>Open Packaging Conventions (OPC) je standard, který popisuje postupy pro ukládání více datových objektů a jejich vzájemných vztahů v jednom fyzickém kontajneru (souboru). Nejčastější formou datového úložiště je ZIP soubor. Tento archiv obsahuje strukturu souborů a složek a dále pak XML dokumenty, které popisují vztahy mezi těmito soubory a obsahují další metadata. Na specifikaci OPC je založena většina novějších souborových formátů Microsoftu. Například OpenXML, nativní formát souborů v Microsoft Office 2007 (soubory s příponami docx, xlsx, pptx atd.). OPC formát je také základem pro dokumenty ve formátu XPS (XML Papar Specification) nebo úložištěm pro Windows Presentation Foundation (WPF). O pravdivosti mých slov se můžete přesvědčit tak, že DOCX soubor (nejlépe takový, který obsahuje další vložené objekty, jako například obrázky, přejmenujete na ZIP a pak ho otevřete.</p>  <p>Pro práci s “balíčky” z prostředí .NET (verze 3.0 a vyšší) slouží třídy v namespace <em>System.IO.Packaging</em>. Jádrem všeho je abstraktní třída <em>Package</em>, která reprezentuje úložiště, které obsahuje jednotlivé položky, reprezentované třídou <em>PackagePart</em>. Úložištěm pro Package může být principiálně cokoliv – stačí implementovat abstraktní třídu <em>Package</em> a obsloužit podkladové úložiště. Nativní reprezentací balíčku je ale ZIP archiv. Ten je dostupný prostřednictvím třídy <em>ZipPackage</em>.</p>  <p>Rád bych na tomto místě zdůraznil, že popisované třídy nejsou určeny pro obecnou práci se ZIP soubory. Jimi vytvořený ZIP archiv bude kromě vašich dat vždy obsahovat minimálně soubor <em>[Content_Types].xml</em> (a patrně ještě další XML dokumenty ve složkách <em>_rels</em> a <em>package</em>, pokud budete využívat metadata a relace mezi částmi). Pro obecnou práci se ZIP archivy se vám bude spíše hodit specializovaná komponenta. Nepsaným standardem je například volně dostupná knihovna <em>#ZipLib</em> od <a href="http://www.icsharpcode.com/">ICsharpCode</a>. <em>System.IO.Packaging</em> se vám bude hodit v případě, že potřebujete pro vlastní potřebu uchovávat nějaké kompozitní datové struktury. Použitím OPC bez námahy získáte podporu komprese, digitálních podpisů či metadat.</p>  <p>Jedna moje aplikace využívá ke své činnosti několik vzájemně souvisejících XML souborů a XSLT šablon. Pro vytváření záloh těchto dat jsem použil právě OPC formát, který mi umožnil uložit samotné soubory, informace o jejich vzájemném vztahu a metadata – jako například kdo a kdy zálohu vytvořil.</p>  <p>  <h2>Vytvoření a inicializace OPC balíčku</h2>  <p>V první řadě musíte do svého projektu přidat referenci na assembly <em>WindowsBase.dll</em>, čímž se vám zpřístupní namespace <em>System.IO.Packaging</em>.</p>  <p>Třída <em>ZipPackage</em> má metodu <em>Open</em>, pomocí které můžete (v závislosti na předaných argumentech) balíček vytvořit nebo otevřít již existující. Pomocí vlastnosti <em>PackageProperties</em> pak můžete nastavovat metadata společná pro celý balíček – název, typ, autora, datum vytvoření a další. Tato data se interně ukládají do XML souboru <em>/package/services/metadata/core-properties/*.psmdcp</em>.</p>  <p>Následujícím kódem vytvoříte balíček a nastavíte jeho metadata:</p>  <div style="font-size: 10pt; background: white; color: black; font-family: consolas, &#39;Courier New&#39;, monospace">   <p style="margin: 0px"><span style="color: green">// Vytvořit package (pokud existuje, bude přepsána)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">Package</span> p = <span style="color: #2b91af">ZipPackage</span>.Open(<span style="color: #a31515">@&quot;C:\Users\Altair\Downloads\demo.zip&quot;</span>, System.IO.<span style="color: #2b91af">FileMode</span>.Create);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">// Nastavit vlastnosti</span></p>    <p style="margin: 0px">p.PackageProperties.Created = <span style="color: #2b91af">DateTime</span>.Now;</p>    <p style="margin: 0px">p.PackageProperties.Creator = System.Security.Principal.<span style="color: #2b91af">WindowsIdentity</span>.GetCurrent().Name;</p>    <p style="margin: 0px">p.PackageProperties.ContentType = <span style="color: #a31515">&quot;Moje Package&quot;</span>;</p>    <p style="margin: 0px">p.PackageProperties.Identifier = <span style="color: #2b91af">Guid</span>.NewGuid().ToString();</p> </div>  <p>  <p>Metadata jsou věc užitečná, nicméně nepovinná. Kompletní seznam a popis dostupných vlastností najdete v <a href="http://go.microsoft.com/fwlink/?LinkID=71255">OPC</a> specifikaci. Zastavím se pouze u dvou obzvláště užitečných. </p>  <p><em>ContentType</em> je typ obsahu a může obsahovat informaci o použitém formátu dokumentu. Zejména poud pro název souboru použijete generickou příponu ZIP, může se jednat o vítanou indikaci, že soubor je v nějakém vámi definovaném formátu a že tedy můžete očekávat jistou strukturu. Sem můžete zapsat jakýkoliv text, přes shodu názvu se nejedná o MIME typ, jako je například <em>text/html</em> a podobně.</p>  <p><em>Identifier</em> je jedinečný identifikátor, který můžete balíčku přiřadit. Může se hodit, pokud chcete obsažená data identifikovat i v případě, že uživatel například soubor přejmenuje.</p>  <h2>Přidání obsahu</h2>  <p>Přidání části (<em>PackagePart</em>) se děje pomocí metody <em>CreatePart</em>, jejíž argumenty jsou:</p>  <ul>   <li><em>partUri</em> - relativní adresa dané části, v ZIP archivu se jedná o název složky a souboru. Slouží jako hlavní identifikátor části a v rámci jedné package musí být jedinečná.</li>    <li><em>contentType</em> – MIME typ obsahu, např. text/plain, text/html, text/xml, image/jpeg… Pokud typ neznáte, použijte application/octet-stream.</li>    <li><em>compressionOption</em> – nepovinný, určuje úroveň komprese, stanovuje poměr mezi výpočetní náročností zpracování a efektivitou komprimace. Pokud parametr není uveden, data se pouze uloží, nebudou se komprimovat. To je užitečné, pokud ukládáte data, která mají náhodnou charakteristiku, jako například data šifrovaná nebo již jednou komprimovaná.</li> </ul>  <p>Metoda vrací instanci třídy <em>PackagePart</em>. Ta má důležitou metodu <em>GetStream</em>, která vrátí stream, jehož prostřednictvím můžete číst a zapisovat data. Neexistuje přímý způsob, jak do balíčku zahrnout existujcíí soubor, musíte ho zkopírovat pomocí streamu.</p>  <p>Následující kód vytvoří balíček se třemi částmi:</p>  <ol>   <li>Textový soubor jménem <em>/readme.txt</em>. Obsah do něj zapíšeme pomocí <em>TextWriteru</em>.</li>    <li>XML soubor jménem <em>/XmlData/MojeXml.xml</em>. Obsah do něj zapíšeme uložením objektu <em>XmlDocument</em>.</li>    <li>Obrázek jménem <em>/Wallpapers/Vista.jpg</em>. Vytvoříme ho zkopírováním obsahu existujícího souboru. Vzhledem k tomu, že se jedná již o jednou zkomprimovaná data (formát JPG je komprimovaný), používám možnost data pouze uložit a nesnažit se o opětovnou kompresi.</li> </ol>  <div style="font-size: 10pt; background: white; color: black; font-family: consolas, &#39;Courier New&#39;, monospace">   <div style="font-size: 10pt; background: white; color: black; font-family: consolas, &#39;Courier New&#39;, monospace">     <p style="margin: 0px"><span style="color: green">// Vytvořit package (pokud existuje, bude přepsána)</span></p>      <p style="margin: 0px"><span style="color: #2b91af">Package</span> p = <span style="color: #2b91af">ZipPackage</span>.Open(<span style="color: #a31515">@&quot;C:\Users\Altair\Downloads\demo.zip&quot;</span>, System.IO.<span style="color: #2b91af">FileMode</span>.Create);</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// Nastavit vlastnosti</span></p>      <p style="margin: 0px">p.PackageProperties.Created = <span style="color: #2b91af">DateTime</span>.Now;</p>      <p style="margin: 0px">p.PackageProperties.Creator = System.Security.Principal.<span style="color: #2b91af">WindowsIdentity</span>.GetCurrent().Name;</p>      <p style="margin: 0px">p.PackageProperties.ContentType = <span style="color: #a31515">&quot;Moje Package&quot;</span>;</p>      <p style="margin: 0px">p.PackageProperties.Identifier = <span style="color: #2b91af">Guid</span>.NewGuid().ToString();</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// Přidat textový soubor</span></p>      <p style="margin: 0px"><span style="color: #2b91af">PackagePart</span> textPart = p.CreatePart(<span style="color: blue">new</span> <span style="color: #2b91af">Uri</span>(<span style="color: #a31515">&quot;/readme.txt&quot;</span>, <span style="color: #2b91af">UriKind</span>.Relative), <span style="color: #a31515">&quot;text/plain&quot;</span>, <span style="color: #2b91af">CompressionOption</span>.Maximum);</p>      <p style="margin: 0px"><span style="color: blue">using</span> (<span style="color: blue">var</span> s = textPart.GetStream())</p>      <p style="margin: 0px"><span style="color: blue">using</span> (<span style="color: blue">var</span> w = <span style="color: blue">new</span> <span style="color: #2b91af">StreamWriter</span>(s)) {</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; 1000; i++) {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; w.WriteLine(<span style="color: #a31515">&quot;Nějaký obsah textového souboru.&quot;</span>);</p>      <p style="margin: 0px">&#160;&#160;&#160; }</p>      <p style="margin: 0px">}</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// Přidat XML dokument </span></p>      <p style="margin: 0px"><span style="color: #2b91af">XmlDocument</span> doc = <span style="color: blue">new</span> <span style="color: #2b91af">XmlDocument</span>();</p>      <p style="margin: 0px">doc.AppendChild(doc.CreateElement(<span style="color: #a31515">&quot;root&quot;</span>));</p>      <p style="margin: 0px"><span style="color: #2b91af">PackagePart</span> xmlPart = p.CreatePart(<span style="color: blue">new</span> <span style="color: #2b91af">Uri</span>(<span style="color: #a31515">&quot;/XmlData/MojeXml.xml&quot;</span>, <span style="color: #2b91af">UriKind</span>.Relative), <span style="color: #a31515">&quot;text/xml&quot;</span>, <span style="color: #2b91af">CompressionOption</span>.Maximum);</p>      <p style="margin: 0px"><span style="color: blue">using</span> (<span style="color: blue">var</span> s = xmlPart.GetStream()) {</p>      <p style="margin: 0px">&#160;&#160;&#160; doc.Save(s);</p>      <p style="margin: 0px">}</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// Přidat existující soubor</span></p>      <p style="margin: 0px"><span style="color: #2b91af">PackagePart</span> jpgPart = p.CreatePart(<span style="color: blue">new</span> <span style="color: #2b91af">Uri</span>(<span style="color: #a31515">&quot;/Wallpapers/Vista.jpg&quot;</span>, <span style="color: #2b91af">UriKind</span>.Relative), <span style="color: #a31515">&quot;image/jpeg&quot;</span>);</p>      <p style="margin: 0px"><span style="color: blue">using</span> (<span style="color: blue">var</span> fileStream = <span style="color: #2b91af">File</span>.OpenRead(<span style="color: #a31515">@&quot;C:\Windows\Web\Wallpaper\img36.jpg&quot;</span>))</p>      <p style="margin: 0px"><span style="color: blue">using</span> (<span style="color: blue">var</span> partStream = jpgPart.GetStream()) {</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">byte</span>[] buffer = <span style="color: blue">new</span> <span style="color: blue">byte</span>[4096];</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">int</span> bytesRead = 0;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">while</span> ((bytesRead = fileStream.Read(buffer, 0, buffer.Length)) &gt; 0) {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; partStream.Write(buffer, 0, bytesRead);</p>      <p style="margin: 0px">&#160;&#160;&#160; }</p>      <p style="margin: 0px">}</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// Zavřít package</span></p>      <p style="margin: 0px">p.Close();</p>   </div>    <p style="margin: 0px"> </div>  <h2>Přečtení obsahu</h2>  <p>  <p>Pro přečtení obsahu je nutné balíček otevřít a získat jeho jednotlivé části. Buďto můžete použít metodu <em>GetPart</em>, pokud přímo znáte její <em>Uri</em> a nebo metodu <em>GetParts</em>, která vám vrátí kolekci všech částí. Ve druhém případě ale dostanete i systémové části, které jste nevytvořili. Poznáte je podle toho, že jejich content type začíná na <em>application/vnd.openxmlformats-package</em>.</p>  <p>Napsal jsem jednoduchou řádkovou utilitku ShowOPC, která vypíše informace o hlaviččce a všech částech OPC balíčku. Její zdrojový kód je následující:</p>  <div style="font-size: 10pt; background: white; color: black; font-family: consolas, &#39;Courier New&#39;, monospace">   <p style="margin: 0px"><span style="color: blue">static</span> <span style="color: blue">void</span> Main(<span style="color: blue">string</span>[] args) {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> (args.Length != 1) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;USAGE: showopc filename&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Environment</span>.Exit(1);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">Package</span> p = <span style="color: blue">null</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">try</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; p = <span style="color: #2b91af">Package</span>.Open(args[0], System.IO.<span style="color: #2b91af">FileMode</span>.Open);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Display properties</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Category:&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Category);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;ContentStatus:&#160; {0}&quot;</span>, p.PackageProperties.ContentStatus);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;ContentType:&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.ContentType);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Created:&#160;&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Created);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Creator:&#160;&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Creator);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Description:&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Description);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Identifier:&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Identifier);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Keywords:&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Keywords);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Language:&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Language);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;LastModifiedBy: {0}&quot;</span>, p.PackageProperties.LastModifiedBy);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;LastPrinted:&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.LastPrinted);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Modified:&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Modified);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Revision:&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Revision);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Subject:&#160;&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Subject);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Title:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Title);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Version:&#160;&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, p.PackageProperties.Version);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Display parts</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> i = 0;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> part <span style="color: blue">in</span> p.GetParts()) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; i++;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Package part {0}:&quot;</span>, i);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;&#160; URI:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {0}&quot;</span>, part.Uri);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;&#160; Content type: {0}&quot;</span>, part.ContentType);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;&#160; Size:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {0:N0} B&quot;</span>, part.GetStream().Length);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;&#160; Compression:&#160; {0}&quot;</span>, part.CompressionOption);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">catch</span> (System.IO.<span style="color: #2b91af">FileNotFoundException</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;File {0} was not found.&quot;</span>, fileName);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">catch</span> (<span style="color: #2b91af">Exception</span> ex) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Failed to read file {0}:&quot;</span>, fileName);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Console</span>.WriteLine(ex.Message);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">finally</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (p != <span style="color: blue">null</span>) p.Close();</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">}</p> </div>  <p>Výsledek výše uvedeného kódu pro námi vytvořenou package je následující:</p>  <div style="font-size: 10pt; background: white; color: black; font-family: consolas, &#39;Courier New&#39;, monospace">   <p style="margin: 0px">File:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; C:\Users\Altair\Downloads\demo.zip</p>    <p style="margin: 0px">Category:</p>    <p style="margin: 0px">ContentStatus:</p>    <p style="margin: 0px">ContentType:&#160;&#160;&#160;&#160; Moje Package</p>    <p style="margin: 0px">Created:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2.8.2008 15:13:21</p>    <p style="margin: 0px">Creator:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; appaloosa\Altair</p>    <p style="margin: 0px">Description:</p>    <p style="margin: 0px">Identifier:&#160;&#160;&#160;&#160;&#160; e555d798-c6bc-4c41-9f03-49472fed1b9c</p>    <p style="margin: 0px">Keywords:</p>    <p style="margin: 0px">Language:</p>    <p style="margin: 0px">LastModifiedBy:</p>    <p style="margin: 0px">LastPrinted:</p>    <p style="margin: 0px">Modified:</p>    <p style="margin: 0px">Revision:</p>    <p style="margin: 0px">Subject:</p>    <p style="margin: 0px">Title:</p>    <p style="margin: 0px">Version:</p>    <p style="margin: 0px">Package part 1:</p>    <p style="margin: 0px">&#160; URI:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /package/services/metadata/core-properties/d5bce375e53b489b9e8bcdf0b2439a20.psmdcp</p>    <p style="margin: 0px">&#160; Content type: application/vnd.openxmlformats-package.core-properties+xml</p>    <p style="margin: 0px">&#160; Size:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 530 B</p>    <p style="margin: 0px">&#160; Compression:&#160; NotCompressed</p>    <p style="margin: 0px">Package part 2:</p>    <p style="margin: 0px">&#160; URI:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /readme.txt</p>    <p style="margin: 0px">&#160; Content type: text/plain</p>    <p style="margin: 0px">&#160; Size:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 36 000 B</p>    <p style="margin: 0px">&#160; Compression:&#160; Maximum</p>    <p style="margin: 0px">Package part 3:</p>    <p style="margin: 0px">&#160; URI:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /Wallpapers/Vista.jpg</p>    <p style="margin: 0px">&#160; Content type: image/jpeg</p>    <p style="margin: 0px">&#160; Size:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 717 578 B</p>    <p style="margin: 0px">&#160; Compression:&#160; NotCompressed</p>    <p style="margin: 0px">Package part 4:</p>    <p style="margin: 0px">&#160; URI:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /XmlData/MojeXml.xml</p>    <p style="margin: 0px">&#160; Content type: text/xml</p>    <p style="margin: 0px">&#160; Size:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8 B</p>    <p style="margin: 0px">&#160; Compression:&#160; Maximum</p>    <p style="margin: 0px">Package part 5:</p>    <p style="margin: 0px">&#160; URI:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /_rels/.rels</p>    <p style="margin: 0px">&#160; Content type: application/vnd.openxmlformats-package.relationships+xml</p>    <p style="margin: 0px">&#160; Size:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 365 B</p>    <p style="margin: 0px">&#160; Compression:&#160; NotCompressed</p> </div>  <p>Zde uvedeným způsobem můžete manipulovat s OpenXML dokumenty, XPS dokumenty, případně vytvářet vlastní datové formáty. Dodržení OPC standardu vám umožní snadno řešit otázky ukládání metadat, vzájemných vztahů, digitálního podpisu a další.</p>  <ul>   <li><a href="https://www.cdn.altairis.cz/Blog/2008/20080802-ShowOPC.zip">Zdrojový kód ShowOPC.exe</a> (3 kB)</li> </ul>