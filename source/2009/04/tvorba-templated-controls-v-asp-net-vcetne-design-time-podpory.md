<!-- dcterms:identifier = aspnetcz#229 -->
<!-- dcterms:title = Tvorba templated controls v ASP.NET, včetně design time podpory -->
<!-- dcterms:abstract = Templatovatelné prvky jsou způsob, jak lze v ASP.NET vytvářet server controls, které mohou v markupu obsahovat další controls. Základní postup pro jejich vytvoření je vcelku jednoduchý, ale pokud chcete, aby váš control byl stejně komfortní jako ty vestavěné, dá to trochu víc práce. -->
<!-- np9:categoryId = 1 -->
<!-- x4w:category = IT -->
<!-- np9:authorId = 1 -->
<!-- np9:authorEmail = michal.valasek@altairis.cz -->
<!-- dcterms:creator = Michal Altair Valášek -->
<!-- dcterms:created = 2009-04-27T03:42:44.83+02:00 -->
<!-- dcterms:dateAccepted = 2009-04-27T03:42:44.83+02:00 -->

<p>Templatovatelné prvky jsou způsob, jak lze v ASP.NET vytvářet server controls, které mohou v markupu obsahovat další controls. Základní postup pro jejich vytvoření je vcelku jednoduchý, ale pokud chcete, aby váš control byl stejně komfortní jako ty vestavěné, dá to trochu víc práce.</p>  <p>Poměrně často používám na svých stránkách &quot;boxy&quot;, které mají zhruba následující HTML kód:</p>  <div style="font-family: consolas, &#39;Courier New&#39;, monospace; background: white; color: black; font-size: 11pt">   <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">div</span> <span style="color: red">class</span><span style="color: blue">=&quot;box&quot;&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">div</span> <span style="color: red">class</span><span style="color: blue">=&quot;box-header&quot;&gt;</span>Text hlavičky<span style="color: blue">&lt;/</span><span style="color: #a31515">div</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">div</span> <span style="color: red">class</span><span style="color: blue">=&quot;box-content&quot;&gt;</span>Text těla<span style="color: blue">&lt;/</span><span style="color: #a31515">div</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">div</span><span style="color: blue">&gt;</span></p> </div>  <p>Uvedený kód může být samozřejmě jednodušší (pro jednoduché formátování, bez obalujícího DIVu) a nebo výrazně složitější (pro různé efekty s hlavičkou a obsahem), nicméně jeho logika je vždy stejná: hlavička a tělo, přičemž obojí může obsahovat buďto prostý text a nebo další server controls.</p>  <h2>První generace</h2>  <p>Budu tedy chtít vytvořit jednoduchý control <em>Box</em>, který bude mít vlastnosti <em>HeaderText</em> a <em>ContentText</em> a možnost specifikovat <em>HeaderTemplate</em> a <em>ContentTemplate</em>, pokud mi prostý text nebude stačit. Samotné vytvoření controlu je dost jednoduché, lze při něm vycházet například z <a href="http://msdn.microsoft.com/en-us/library/aa719862(VS.71).aspx">návodu, který najdete na MSDN</a>. První verze kódu – s minimální implementací - tedy vypadá takto:</p>  <div style="font-family: consolas, &#39;Courier New&#39;, monospace; background: white; color: black; font-size: 11pt">   <p style="margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web.UI;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web.UI.WebControls;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> MyControls {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">ParseChildren</span>(<span style="color: blue">true</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Box</span> : <span style="color: #2b91af">Control</span>, <span style="color: #2b91af">INamingContainer</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">TemplateContainer</span> : <span style="color: #2b91af">Control</span>, <span style="color: #2b91af">INamingContainer</span> { }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">TemplateContainer</span> headerTC, contentTC;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> Box() {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.CssClass = <span style="color: #a31515">&quot;box&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.CssClassHeader = <span style="color: #a31515">&quot;box-header&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.CssClassContent = <span style="color: #a31515">&quot;box-content&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">TemplateContainer</span>(<span style="color: blue">typeof</span>(<span style="color: #2b91af">TemplateContainer</span>))]</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">ITemplate</span> HeaderTemplate { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">TemplateContainer</span>(<span style="color: blue">typeof</span>(<span style="color: #2b91af">TemplateContainer</span>))]</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">ITemplate</span> ContentTemplate { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> HeaderText {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;HeaderText&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;HeaderText&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> ContentText {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;ContentText&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;ContentText&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> CssClass {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClass&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClass&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> CssClassHeader {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassHeader&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassHeader&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> CssClassContent {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassContent&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassContent&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">protected</span> <span style="color: blue">override</span> <span style="color: blue">void</span> OnDataBinding(<span style="color: #2b91af">EventArgs</span> e) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.EnsureChildControls();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">base</span>.OnDataBinding(e);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">protected</span> <span style="color: blue">override</span> <span style="color: blue">void</span> CreateChildControls() {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create core layout</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> boxPanel = <span style="color: blue">new</span> <span style="color: #2b91af">Panel</span> { CssClass = <span style="color: blue">this</span>.CssClass };</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> headerPanel = <span style="color: blue">new</span> <span style="color: #2b91af">Panel</span> { CssClass = <span style="color: blue">this</span>.CssClassHeader };</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> contentPanel = <span style="color: blue">new</span> <span style="color: #2b91af">Panel</span> { CssClass = <span style="color: blue">this</span>.CssClassContent };</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; boxPanel.Controls.Add(headerPanel);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; boxPanel.Controls.Add(contentPanel);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.Controls.Add(boxPanel);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create header</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (<span style="color: blue">this</span>.HeaderTemplate == <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; headerPanel.Controls.Add(<span style="color: blue">new</span> <span style="color: #2b91af">LiteralControl</span>(<span style="color: blue">this</span>.HeaderText));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.headerTC = <span style="color: blue">new</span> <span style="color: #2b91af">TemplateContainer</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.HeaderTemplate.InstantiateIn(<span style="color: blue">this</span>.headerTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; headerPanel.Controls.Add(<span style="color: blue">this</span>.headerTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create content</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (<span style="color: blue">this</span>.ContentTemplate == <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; contentPanel.Controls.Add(<span style="color: blue">new</span> <span style="color: #2b91af">LiteralControl</span>(<span style="color: blue">this</span>.ContentText));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.contentTC = <span style="color: blue">new</span> <span style="color: #2b91af">TemplateContainer</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.ContentTemplate.InstantiateIn(<span style="color: blue">this</span>.contentTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; contentPanel.Controls.Add(<span style="color: blue">this</span>.contentTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">}</p> </div>  <p>Kód testovací stránky vypadá následovně:</p>  <div style="font-family: consolas, &#39;Courier New&#39;, monospace; background: white; color: black; font-size: 11pt">   <p style="margin: 0px"><span style="color: blue">&lt;!</span><span style="color: #a31515">DOCTYPE</span> <span style="color: red">html</span> <span style="color: red">PUBLIC</span> <span style="color: blue">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span style="color: blue">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span></p>    <p style="margin: 0px"><span style="background: #ffee62">&lt;%</span><span style="color: blue">@</span> <span style="color: #a31515">Page</span> <span style="color: red">Language</span><span style="color: blue">=&quot;C#&quot;</span> <span style="background: #ffee62">%&gt;</span></p>    <p style="margin: 0px"><span style="background: #ffee62">&lt;%</span><span style="color: blue">@</span> <span style="color: #a31515">Register</span> <span style="color: red">TagPrefix</span><span style="color: blue">=&quot;my&quot;</span> <span style="color: red">Namespace</span><span style="color: blue">=&quot;MyControls&quot;</span> <span style="background: #ffee62">%&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">html</span> <span style="color: red">xmlns</span><span style="color: blue">=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">head</span> <span style="color: red">runat</span><span style="color: blue">=&quot;server&quot;&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">title</span><span style="color: blue">&gt;&lt;/</span><span style="color: #a31515">title</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">style</span> <span style="color: red">type</span><span style="color: blue">=&quot;text/css&quot;&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">.box</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: red">border</span>: <span style="color: blue">solid</span> <span style="color: blue">1px</span> <span style="color: blue">#990000</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: red">width</span>: <span style="color: blue">300px</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">.box-header</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: red">background-color</span>: <span style="color: blue">#990000</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: red">color</span>: <span style="color: blue">#ffffff</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: red">padding</span>: <span style="color: blue">1ex</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">.box-content</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: red">background-color</span>: <span style="color: blue">#eeeeee</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: red">padding</span>: <span style="color: blue">1ex</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: #a31515">style</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">head</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">body</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">form</span> <span style="color: red">id</span><span style="color: blue">=&quot;form1&quot;</span> <span style="color: red">runat</span><span style="color: blue">=&quot;server&quot;&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">my</span><span style="color: blue">:</span><span style="color: #a31515">Box</span> <span style="color: red">ID</span><span style="color: blue">=&quot;Box1&quot;</span> <span style="color: red">runat</span><span style="color: blue">=&quot;server&quot;</span> <span style="color: red">HeaderText</span><span style="color: blue">=&quot;Text hlavičky&quot;&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">ContentTemplate</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: #a31515">asp</span><span style="color: blue">:</span><span style="color: #a31515">TextBox</span> <span style="color: red">ID</span><span style="color: blue">=&quot;TextBox1&quot;</span> <span style="color: red">runat</span><span style="color: blue">=&quot;server&quot;</span> <span style="color: blue">/&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: #a31515">ContentTemplate</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: #a31515">my</span><span style="color: blue">:</span><span style="color: #a31515">Box</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: #a31515">form</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">body</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">html</span><span style="color: blue">&gt;</span></p> </div>  <h2>Druhá generace: property grid a IntelliSense</h2>  <p>Popsaný control funguje jak má. Což je bohužel asi tak všechno, co se o něm dá říct pozitivního. Design time podpora veškerá žádná. IntelliSense tag <em>&lt;ContentTemplate&gt;</em> nezná, takže editor se bude vztekat. V náhledovém režimu se zobrazí pouze prostý text <em>[ Control: Box1]</em> a víc z něj nedostanete… Řešení problému je přitom celkem snadné, druhá postupná verze vypadá následovně (změny jsou označené tučně):</p>  <div style="font-family: consolas, &#39;Courier New&#39;, monospace; background: white; color: black; font-size: 11pt">   <p style="margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="margin: 0px"><strong><span style="color: blue">using</span> System.ComponentModel;</strong></p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web.UI;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web.UI.WebControls;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> MyControls {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">ParseChildren</span>(<span style="color: blue">true</span>)<strong>, <span style="color: #2b91af">PersistChildren</span>(<span style="color: blue">false</span>)</strong>]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Box</span> : <span style="color: #2b91af">Control</span>, <span style="color: #2b91af">INamingContainer</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">TemplateContainer</span> : <span style="color: #2b91af">Control</span>, <span style="color: #2b91af">INamingContainer</span> { }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">TemplateContainer</span> headerTC, contentTC;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> Box() {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.CssClass = <span style="color: #a31515">&quot;box&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.CssClassHeader = <span style="color: #a31515">&quot;box-header&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.CssClassContent = <span style="color: #a31515">&quot;box-content&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">TemplateContainer</span>(<span style="color: blue">typeof</span>(<span style="color: #2b91af">TemplateContainer</span>))]</p>    <p style="margin: 0px"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">Browsable</span>(<span style="color: blue">false</span>), <span style="color: #2b91af">PersistenceMode</span>(<span style="color: #2b91af">PersistenceMode</span>.InnerProperty)]</strong></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">ITemplate</span> HeaderTemplate { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">TemplateContainer</span>(<span style="color: blue">typeof</span>(<span style="color: #2b91af">TemplateContainer</span>))]</p>    <p style="margin: 0px"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">Browsable</span>(<span style="color: blue">false</span>), <span style="color: #2b91af">PersistenceMode</span>(<span style="color: #2b91af">PersistenceMode</span>.InnerProperty)]</strong></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">ITemplate</span> ContentTemplate { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">Category</span>(<span style="color: #a31515">&quot;Behavior&quot;</span>), <span style="color: #2b91af">Description</span>(<span style="color: #a31515">&quot;Text of box header if HeaderTemplate is not specified.&quot;</span>)]</strong></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> HeaderText {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;HeaderText&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;HeaderText&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">Category</span>(<span style="color: #a31515">&quot;Behavior&quot;</span>), <span style="color: #2b91af">Description</span>(<span style="color: #a31515">&quot;Text of box content if ContentTemplate is not specified.&quot;</span>)]</strong></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> ContentText {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;ContentText&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;ContentText&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">Category</span>(<span style="color: #a31515">&quot;Appearance&quot;</span>), <span style="color: #2b91af">Description</span>(<span style="color: #a31515">&quot;Box CSS class&quot;</span>), <span style="color: #2b91af">DefaultValue</span>(<span style="color: #a31515">&quot;box&quot;</span>), <span style="color: #2b91af">CssClassProperty</span>]</strong></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> CssClass {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClass&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClass&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">Category</span>(<span style="color: #a31515">&quot;Appearance&quot;</span>), <span style="color: #2b91af">Description</span>(<span style="color: #a31515">&quot;Box header CSS class&quot;</span>), <span style="color: #2b91af">DefaultValue</span>(<span style="color: #a31515">&quot;box-header&quot;</span>), <span style="color: #2b91af">CssClassProperty</span>]</strong></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> CssClassHeader {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassHeader&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassHeader&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; [<span style="color: #2b91af">Category</span>(<span style="color: #a31515">&quot;Appearance&quot;</span>), <span style="color: #2b91af">Description</span>(<span style="color: #a31515">&quot;Box content CSS class&quot;</span>), <span style="color: #2b91af">DefaultValue</span>(<span style="color: #a31515">&quot;box-content&quot;</span>), <span style="color: #2b91af">CssClassProperty</span>]</strong></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> CssClassContent {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">string</span>)<span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassContent&quot;</span>]; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">set</span> { <span style="color: blue">this</span>.ViewState[<span style="color: #a31515">&quot;CssClassContent&quot;</span>] = <span style="color: blue">value</span>; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">protected</span> <span style="color: blue">override</span> <span style="color: blue">void</span> OnDataBinding(<span style="color: #2b91af">EventArgs</span> e) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.EnsureChildControls();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">base</span>.OnDataBinding(e);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">protected</span> <span style="color: blue">override</span> <span style="color: blue">void</span> CreateChildControls() {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create core layout</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> boxPanel = <span style="color: blue">new</span> <span style="color: #2b91af">Panel</span> { CssClass = <span style="color: blue">this</span>.CssClass };</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> headerPanel = <span style="color: blue">new</span> <span style="color: #2b91af">Panel</span> { CssClass = <span style="color: blue">this</span>.CssClassHeader };</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> contentPanel = <span style="color: blue">new</span> <span style="color: #2b91af">Panel</span> { CssClass = <span style="color: blue">this</span>.CssClassContent };</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; boxPanel.Controls.Add(headerPanel);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; boxPanel.Controls.Add(contentPanel);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.Controls.Add(boxPanel);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create header</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (<span style="color: blue">this</span>.HeaderTemplate == <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; headerPanel.Controls.Add(<span style="color: blue">new</span> <span style="color: #2b91af">LiteralControl</span>(<span style="color: blue">this</span>.HeaderText));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.headerTC = <span style="color: blue">new</span> <span style="color: #2b91af">TemplateContainer</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.HeaderTemplate.InstantiateIn(<span style="color: blue">this</span>.headerTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; headerPanel.Controls.Add(<span style="color: blue">this</span>.headerTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create content</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (<span style="color: blue">this</span>.ContentTemplate == <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; contentPanel.Controls.Add(<span style="color: blue">new</span> <span style="color: #2b91af">LiteralControl</span>(<span style="color: blue">this</span>.ContentText));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.contentTC = <span style="color: blue">new</span> <span style="color: #2b91af">TemplateContainer</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.ContentTemplate.InstantiateIn(<span style="color: blue">this</span>.contentTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; contentPanel.Controls.Add(<span style="color: blue">this</span>.contentTC);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">}</p> </div>  <p>Provedené změny spočívají pouze v odekorování třídy a vlastností několika atributy. Převážná vtěšina z nich se zabývá zpřehledněním zobrazení v property gridu a nachází se v namespace <em>System.ComponentModel</em>:</p>  <ul>   <li><strong>Category</strong> určuje, do jaké kategorie se vlastnost zařadí při zobrazení v property gridu. Můžeme použít obvyklé kategorie, nebo si vytvořit vlastní. Výsledkem v každém případě bude lepší přehlednost gridu, že všechny vlastnosti nebudou nasypané na jedné hromadě v kategorii <em>Misc</em>. </li>    <li><strong>Description</strong> je textový popis vlastnosti, který se zobrazí ve spodní části property gridu. </li>    <li><strong>DefaultValue</strong> je výchozí hodnota. V gridu budou tučně označeny jenom ty vlastnosti, jejichž hodnoty se odlišují od defaultu. </li>    <li><strong>Browsable(false)</strong> způsobí, že se takto označená metoda nebude v gridu zobrazovat vůbec, což se hodí mimo jiné právě v případě šablon. </li>    <li><strong>CssClassProperty</strong> by měl způsobit, že bude hodnota vlastnosti rozpoznána jako CSS třída a bude se tedy nabízet seznam tříd v IntelliSense a rozbalovací seznam v gridu. Bohužel to z mně neznámých důvodů nefunguje, VS2008SP1 se orientuje pouze podle názvu vlastnosti (musí se jmenovat <em>CssClass</em>) a atribut ignoruje. Podle mne se jedná o chybu ve v Visual Studiu, budu to dále řešit. </li> </ul>  <p>Atributy <strong>PersistChildren</strong> a <strong>PersistenceMode</strong> slouží k indikaci, že daná vlastnost není realizována klasicky HTML atributem, ale právě vnořeným elementem. Vyřeší tedy problém s IntelliSense.</p>  <p>  <h2>Třetí generace: Designer</h2>  <p>Stále ale nemáme u tohoto controlu podporu pro design mode, tedy rozumné zobrazení prvku v designeru ani podporu pro vizuální editaci šablon. Tady už si s prostými atributy nevystačíme, a potřebujeme designer. Designer je speciální pomocná třída, poděděná od base class <em>ControlDesigner</em>. Nemá žádný vliv na vlastní funkčnost prvku jako takového, slouží čistě pro podporu v design time režimu.</p>  <p><img style="border-right-width: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto" title="Template editor smart tag" border="0" alt="Template editor smart tag" src="https://www.cdn.altairis.cz/Blog/2009/20090427-20090427-smarttag_3.png" width="545" height="272"></p>  <p>Designer využijeme pro dvě v podstatě nezávislé věci. Za prvé, přepíšeme v něm metodu <em>GetDesignTimeHtml</em>, která vrací HTML kód, který se použije pro zobrazení na ploše vizuálního návrhu. Za druhé, sdělíme Visual Studiu, jaké šablony náš prvek používá, aby mohlo vygenerovat odpovídající rozhraní ve smart tagu.Zdrojový kód bude vypadat následovně:</p>  <div style="font-family: consolas, &#39;Courier New&#39;, monospace; background: white; color: black; font-size: 11pt">   <p style="margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.ComponentModel;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web.UI;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web.UI.Design;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web.UI.WebControls;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> MyControls {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">ParseChildren</span>(<span style="color: blue">true</span>), <span style="color: #2b91af">PersistChildren</span>(<span style="color: blue">false</span>), <strong><span style="color: #2b91af">Designer</span>(<span style="color: blue">typeof</span>(<span style="color: #2b91af">BoxDesigner</span>))</strong>]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Box</span> : <span style="color: #2b91af">Control</span>, <span style="color: #2b91af">INamingContainer</span> {</p>    <p style="margin: 0px"><em>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Kód třídy samé je stejný jako v předchozím případě</span></em></p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">BoxDesigner</span> : <span style="color: #2b91af">ControlDesigner</span> {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #region</span> Implementace podpory šablon</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">TemplateGroupCollection</span> templateGroups;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">void</span> Initialize(<span style="color: #2b91af">IComponent</span> component) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">base</span>.Initialize(component);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">base</span>.SetViewFlags(<span style="color: #2b91af">ViewFlags</span>.TemplateEditing, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: #2b91af">TemplateGroupCollection</span> TemplateGroups {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (<span style="color: blue">this</span>.templateGroups == <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.templateGroups = <span style="color: blue">new</span> <span style="color: #2b91af">TemplateGroupCollection</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">TemplateGroup</span> group = <span style="color: blue">new</span> <span style="color: #2b91af">TemplateGroup</span>(<span style="color: #a31515">&quot;Templates&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; group.AddTemplateDefinition(<span style="color: blue">new</span> <span style="color: #2b91af">TemplateDefinition</span>(<span style="color: blue">this</span>, <span style="color: #a31515">&quot;Header&quot;</span>, <span style="color: blue">this</span>.Component, <span style="color: #a31515">&quot;HeaderTemplate&quot;</span>, <span style="color: blue">false</span>));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; group.AddTemplateDefinition(<span style="color: blue">new</span> <span style="color: #2b91af">TemplateDefinition</span>(<span style="color: blue">this</span>, <span style="color: #a31515">&quot;Content&quot;</span>, <span style="color: blue">this</span>.Component, <span style="color: #a31515">&quot;ContentTemplate&quot;</span>, <span style="color: blue">false</span>));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.templateGroups.Add(group);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">this</span>.templateGroups;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #endregion</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #region</span> Implementace zobrazení v designeru</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">string</span> GetDesignTimeHtml() {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> control = <span style="color: blue">this</span>.Component <span style="color: blue">as</span> <span style="color: #2b91af">Box</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> sb = <span style="color: blue">new</span> System.Text.<span style="color: #2b91af">StringBuilder</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sb.AppendFormat(<span style="color: #a31515">&quot;&lt;div class=\&quot;{0}\&quot;&gt;&lt;div class=\&quot;{1}\&quot;&gt;&quot;</span>, control.CssClass, control.CssClassHeader);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sb.Append(<span style="color: blue">this</span>.GetHeaderDesignTimeHtml());</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sb.AppendFormat(<span style="color: #a31515">&quot;&lt;/div&gt;&lt;div class=\&quot;{0}\&quot;&gt;&quot;</span>, control.CssClassContent);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sb.Append(<span style="color: blue">this</span>.GetContentDesignTimeHtml());</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sb.Append(<span style="color: #a31515">&quot;&lt;/div&gt;&lt;/div&gt;&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> sb.ToString();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">string</span> GetHeaderDesignTimeHtml() {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> control = <span style="color: blue">this</span>.Component <span style="color: blue">as</span> <span style="color: #2b91af">Box</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (control.HeaderTemplate != <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> ph = <span style="color: blue">new</span> <span style="color: #2b91af">PlaceHolder</span>()) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; control.HeaderTemplate.InstantiateIn(ph);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> RenderControlToString(ph);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> <span style="color: blue">if</span> (!<span style="color: blue">string</span>.IsNullOrEmpty(control.HeaderText)) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> control.HeaderText;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #a31515">&quot;[Header]&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">string</span> GetContentDesignTimeHtml() {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> control = <span style="color: blue">this</span>.Component <span style="color: blue">as</span> <span style="color: #2b91af">Box</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (control.ContentTemplate != <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> ph = <span style="color: blue">new</span> <span style="color: #2b91af">PlaceHolder</span>()) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; control.ContentTemplate.InstantiateIn(ph);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> RenderControlToString(ph);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> <span style="color: blue">if</span> (!<span style="color: blue">string</span>.IsNullOrEmpty(control.ContentText)) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> control.ContentText;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #a31515">&quot;[Content]&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">string</span> RenderControlToString(<span style="color: #2b91af">Control</span> control) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (control == <span style="color: blue">null</span>) <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">ArgumentNullException</span>(<span style="color: #a31515">&quot;control&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> tw = <span style="color: blue">new</span> System.IO.<span style="color: #2b91af">StringWriter</span>())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> hw = <span style="color: blue">new</span> <span style="color: #2b91af">HtmlTextWriter</span>(tw)) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; control.RenderControl(hw);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> tw.ToString();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #endregion</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">}</p> </div>  <p>Vytvoříme třídu <em>BoxDesigner</em>, kterou podědíme od <em>ControlDesigner</em>. Původní control sám jenom odekorujeme atributem <em>Designer</em>, jinak kód zůstává nezměněn. Jinak je kód myslím dosti polopatický.</p>  <p>Na závěr se snad sluší jenom připomenout, že až budete experimentovat s design mode podporou server controls, nezapomeňte vždy zavřít a znovu otevřít ASPX soubor, protože jedině tak se obnoví cache a nebudete pracovat se starou verzí.</p>