<!-- dcterms:identifier = aspnetcz#238 -->
<!-- dcterms:title = ViewState: Novinky v ASP.NET 4.0 -->
<!-- dcterms:abstract = V předchozích článcích této série jsem popsal implementaci ViewState a ControlState v aktuální verzi ASP.NET, tedy 3.5 SP1. V tomto, posledním, článku se podíváme do budoucnosti: na novinky, které nás čekají ve verzi 4.0. Mnou popisovaný stav se týká verze Beta 1 a je dobré ho tedy brát s rezervou – zde prezentované informace se mohou ještě změnit. -->
<!-- np9:categoryId = 1 -->
<!-- x4w:category = IT -->
<!-- np9:authorId = 1 -->
<!-- np9:authorEmail = michal.valasek@altairis.cz -->
<!-- dcterms:creator = Michal Altair Valášek -->
<!-- np9:serialId = 5 -->
<!-- x4w:serial = ViewState -->
<!-- dcterms:created = 2009-07-03T09:00:00+02:00 -->
<!-- dcterms:dateAccepted = 2009-07-03T09:00:00+02:00 -->

<p>V předchozích článcích této série jsem popsal implementaci ViewState a ControlState v aktuální verzi ASP.NET, tedy 3.5 SP1. V tomto, posledním, článku se podíváme do budoucnosti: na novinky, které nás čekají ve verzi 4.0. Mnou popisovaný stav se týká verze Beta 1 a je dobré ho tedy brát s rezervou – zde prezentované informace se mohou ještě změnit.</p>
<p>ASP.NET 4.0 změní logiku zapínání a vypínání ViewState. Dosavadní vlastnost <code>EnableViewState</code> sice zůstává zachována, ale jenom na úrovni aplikace nebo stránky. Na úrovni jednotlivého controlu bude ignorována. Tímto způsobem tedy nebude možné ViewState u jednotlivých ovládacích prvků vypnout. Zůstává také zachováno chování, že touto metodou vypnutý ViewState nelze na nižší úrvni zapnout.</p>
<p>Přibyla ale nová vlastnost <code>ViewStateMode</code>, která může nabývat hodnot <code>Enable</code>, <code>Disable</code> a <code>Inherit</code>. Výchozí hodnota je <code>Inherit</code>. Pokud tímto způsobem na nadřízené úrovni ViewState vypnete, na nižší úrovni ji můžete zase zapnout. Například v následující stránce bude ViewState povoleno pouze u prvku <code>SampleStateControl1</code>:</p>
<div style="font-family: consolas, 'courier new', monospace; background: white; color: black; font-size: 10pt;">
<p style="margin: 0px;"><span style="background: #ffee62;">&lt;%</span><span style="color: #0000ff;">@</span> <span style="color: #a31515;">Page</span> <span style="color: #ff0000;">Language</span><span style="color: #0000ff;">="C#"</span> <strong><span style="color: #ff0000;">ViewStateMode</span><span style="color: #0000ff;">="Disabled"</span></strong> <span style="background: #ffee62;">%&gt;</span></p>
<p style="margin: 0px;"><span style="background: #ffee62;">&lt;%</span><span style="color: #0000ff;">@</span> <span style="color: #a31515;">Register</span> <span style="color: #ff0000;">TagPrefix</span><span style="color: #0000ff;">="sample"</span> <span style="color: #ff0000;">Namespace</span><span style="color: #0000ff;">="MyControls"</span> <span style="background: #ffee62;">%&gt;</span></p>
<p style="margin: 0px;"><span style="color: #0000ff;">&lt;!</span><span style="color: #a31515;">DOCTYPE</span> <span style="color: #ff0000;">html</span> <span style="color: #ff0000;">PUBLIC</span> <span style="color: #0000ff;">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span style="color: #0000ff;">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></p>
<p style="margin: 0px;"><span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">html</span> <span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"&gt;</span></p>
<p style="margin: 0px;"><span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">head</span> <span style="color: #ff0000;">runat</span><span style="color: #0000ff;">="server"&gt;</span></p>
<p style="margin: 0px;">    <span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #a31515;">title</span><span style="color: #0000ff;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: #0000ff;">&lt;/</span><span style="color: #a31515;">head</span><span style="color: #0000ff;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">body</span><span style="color: #0000ff;">&gt;</span></p>
<p style="margin: 0px;">    <span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">form</span> <span style="color: #ff0000;">id</span><span style="color: #0000ff;">="form1"</span> <span style="color: #ff0000;">runat</span><span style="color: #0000ff;">="server"&gt;</span></p>
<p style="margin: 0px;">    <span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">sample</span><span style="color: #0000ff;">:</span><span style="color: #a31515;">SampleStateControl</span> <span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="SampleStateControl1"</span> <span style="color: #ff0000;">runat</span><span style="color: #0000ff;">="server"</span> <strong><span style="color: #ff0000;">ViewStateMode</span><span style="color: #0000ff;">="Enabled"</span></strong> <span style="color: #0000ff;">/&gt;</span></p>
<p style="margin: 0px;">    <span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">sample</span><span style="color: #0000ff;">:</span><span style="color: #a31515;">SampleStateControl</span> <span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="SampleStateControl2"</span> <span style="color: #ff0000;">runat</span><span style="color: #0000ff;">="server"</span> <span style="color: #0000ff;">/&gt;</span></p>
<p style="margin: 0px;">    <span style="color: #0000ff;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: #0000ff;">:</span><span style="color: #a31515;">Button</span> <span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="Button1"</span> <span style="color: #ff0000;">Text</span><span style="color: #0000ff;">="Submit"</span> <span style="color: #ff0000;">runat</span><span style="color: #0000ff;">="server"</span> <span style="color: #0000ff;">/&gt;</span></p>
<p style="margin: 0px;">    <span style="color: #0000ff;">&lt;/</span><span style="color: #a31515;">form</span><span style="color: #0000ff;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: #0000ff;">&lt;/</span><span style="color: #a31515;">body</span><span style="color: #0000ff;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: #0000ff;">&lt;/</span><span style="color: #a31515;">html</span><span style="color: #0000ff;">&gt;</span></p>
</div>
<p>Ve verzi Beta 1 se mi nepodařilo přijít na způsob, jak ViewState tímto způsobem (tedy s možností ho na vyžádání zapnout) vypnout pro celou aplikaci, tedy konfiguračně. Nevím, zda je to úkaz rázu trvalého a nebo jenom dočasného, v této betě. I kdyby se ale jednalo o úkaz rázu trvalého, je to pořád výrazný krok kupředu. A protože <code>ViewStateMode</code> lze nastavit i na úrovni master page, není absence této vlastnosti příliš truchlivá. Většina webů používá jenom jednu hlavní master page, takže nastavení na její úrovni je funkčně ekvivalentní nastavení na úrovni aplikace.</p>
<p>Pokud s chcete s touto funkcionalitou pohrát, můžete – beta 1 je <a shape="rect" href="http://www.microsoft.com/visualstudio/en-us/products/2010/default.mspx" shape="rect">volně ke stažení na webu Microsoftu</a>. V takovém případě by se vám mohlo nicméně hodit moje upozornění, že IntelliSense dosud vlastnost <code>ViewStateMode</code> zná jenom u běžných controlů, nikoliv tedy u direktiv jako je <code>@Page</code> nebo <code>@Master</code>. Pokud je tam nicméně "natvrdo" napíšete, všechno bude spokojeně fungovat.</p>
<p><em>Tímto článkem končí stručná série o vlastnostech, využití a implementaci technologie ViewState. Doufám, že se mi podařilo odstranit některé mýty, které o ViewState v programátorských kruzích panují, a že nyní budete ViewState a ControlState využívat správným a případným způsobem.</em></p>
