<!-- dcterms:identifier = aspnetcz#300 -->
<!-- dcterms:title = InstallUtil.exe – instalační a odinstalační procedury -->
<!-- dcterms:abstract = Instalace ASP.NET aplikace probíhá obvykle stylem "nakopíruj tohle do rootu webu a modli se". Součástí aplikace ale často bývají různé pomocné utilitky, které při své instalaci a odinstalaci vyžadují různé úkony. Například vložení do GAC, instalaci služby (Windows service), vytvoření protoklu událostí (vlastní event log a nebo alespoň event log source). Microsoft .NET framework na to má infrastrukturu v podobě instalačních tříd: užitečného, leč často přehlíženého nástroje. -->
<!-- np9:categoryId = 1 -->
<!-- x4w:category = Programování -->
<!-- np9:authorId = 1 -->
<!-- np9:authorEmail = michal.valasek@altairis.cz -->
<!-- dcterms:creator = Michal Altair Valášek -->
<!-- dcterms:created = 2010-09-23T21:55:53.243+02:00 -->
<!-- dcterms:dateAccepted = 2010-09-23T21:55:56.007+02:00 -->
<!-- x4w:pictureWidth = 150 -->
<!-- x4w:pictureHeight = 150 -->
<!-- x4w:pictureUrl = /perex-pictures/20100923-installutil-exe-instalacni-a-odinstalacni-procedury.png -->

<p>Instalace ASP.NET aplikace probíhá obvykle stylem &quot;nakopíruj tohle do rootu webu a modli se&quot;. Součástí aplikace ale často bývají různé pomocné utilitky, které při své instalaci a odinstalaci vyžadují různé úkony. Například vložení do GAC, instalaci služby (Windows service), vytvoření protoklu událostí (vlastní event log a nebo alespoň event log source). Microsoft .NET framework na to má infrastrukturu v podobě instalačních tříd: užitečného, leč často přehlíženého nástroje.</p>  <p>Hned na úvod je nutné upozornit na jednu důležitou věc: v tomto článku nebude řeč o vytváření instalačních balíčků, setup projektech, MSI a podobných věcech. Zaměříme se na specifické činnost, které konkrétní assemblies potřebují k životu.Ty lze vyvolat buďto ručně, pomocí utility InstallUtil.exe, která je součástí .NET Frameworku, nebo v rámci &quot;velké&quot; instalace, jako jsou např. různé formy setup projektů ve Visual Studiu.</p>  <h2>Jak funguje InstallUtil.exe</h2>  <p>Utilitka <em>InstallUtil.exe</em> je součástí .NET Frameworku. Slouží k instalaci a odinstalaci assembly, přičemž záleží pouze na assembly samotné, jaké konkrétní úkony bude instalace a odinstalace zahrnovat. Jedná se o konzolový program, který se spouští z příkazové řádky a ovládá se pomocí parametrů. Jeho nejtypičtější použití nicméně je pouze s názvem assembly, pro instalaci:</p>  <pre style="font-family: "><font face="Consolas"><font style="font-size: 12pt">InstallUtil.exe C:\Cesta\k\assembly.dll</font></font></pre>

<p>Odinstalace se pak provádí přidáním parametru /u:</p>

<pre style="font-family: "><font face="Consolas"><font style="font-size: 12pt">InstallUtil.exe /u C:\Cesta\k\assembly.dll</font></font><br></pre>

<p>Assembly přitom může být jak spustitelný program (<em>.exe</em>), tak cokoliv jiného, třeba class library (<em>.dll</em>). Toho jsem využil například ve svém modulu pro obcházení AES chyby v ASP.NET, o kterém jsem psal před pár dny. Je potřeba ho nainstalovat, konkrétně vložit tuto assembly do GAC a zaregistrovat HTTP modul na úrovni serveru.</p>

<p>Vytvářet pro tak jednoduchou aplikaci kompletní setup by byl poněkud overkill. Ruční instalace by byla zase dost komplikovaná, zejména pak proto, že <em>GacUtil.exe</em>, používaná pro ruční instalaci assembly do GAC, není součástí .NET Frameworku ale jen SDK, takže na serveru patrně nebude nainstalovaná. Proto jsem použil instalátory a <em>InstallUtil.exe</em>.</p>

<p>InstallUtil funguje tak, že v dané assembly najde všechy instalační třídy, označené atributem <em>[RunInstaller(true)]</em> a v nich spustí metodu <em>Install</em>, potažmo <em>Uninstall</em>.</p>

<h2>Instalační třídy</h2>

<p>Pro potřeby instalace se používají instalační třídy (installer classes). Ve své podstatě jde o běžnou třídu, která je poděděná od <em>System.Configuration.Install.Installer</em>. V ní přepíšeme metody <em>Install</em> a <em>Uninstall</em> a do nich doplníme logiku, kterou naše instalace vyžaduje.</p>

<p>Můžeme vytvořit například třídu <em>AssemblyGacInstaller</em>, která vloží aktuální assembly do Global Assembly Cache (a v případě odinstalace ji zase odstraní). Je velmi jednoduchá, nemá žádné parametry, a vypadá takto:</p>

<pre style="margin-top: auto; font-family: ; margin-bottom: auto"><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> System;</font></font><br><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> System.Collections;</font></font><br><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> System.Configuration.Install;</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">namespace</font></span><font style="font-size: 12pt"> Altairis.Web.OracleBugFix.Install {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">partial</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">class</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">AssemblyGacInstaller</font></span><font style="font-size: 12pt"> : </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Installer</font></span><font style="font-size: 12pt"> {</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Installer methods</font></span></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">override</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">void</font></span><font style="font-size: 12pt"> Install(</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">IDictionary</font></span><font style="font-size: 12pt"> stateSaver) {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Base install task</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">base</font></span><font style="font-size: 12pt">.Install(stateSaver);</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Install current assembly to GAC</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">try</font></span><font style="font-size: 12pt"> {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Installing assembly to GAC...&quot;</font></span><font style="font-size: 12pt">);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">var</font></span><font style="font-size: 12pt"> mya = System.Reflection.</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Assembly</font></span><font style="font-size: 12pt">.GetExecutingAssembly();</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">var</font></span><font style="font-size: 12pt"> p = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt"> System.EnterpriseServices.Internal.</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Publish</font></span><font style="font-size: 12pt">();</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; p.GacInstall(mya.Location);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">catch</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Exception</font></span><font style="font-size: 12pt"> ex) {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Failed!&quot;</font></span><font style="font-size: 12pt">);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(ex.ToString());</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">override</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">void</font></span><font style="font-size: 12pt"> Uninstall(</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">IDictionary</font></span><font style="font-size: 12pt"> savedState) {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Base uninstall task</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">base</font></span><font style="font-size: 12pt">.Uninstall(savedState);</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Remove current assembly from GAC</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">try</font></span><font style="font-size: 12pt"> {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Removing assembly from GAC...&quot;</font></span><font style="font-size: 12pt">);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">var</font></span><font style="font-size: 12pt"> mya = System.Reflection.</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Assembly</font></span><font style="font-size: 12pt">.GetExecutingAssembly();</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">var</font></span><font style="font-size: 12pt"> p = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt"> System.EnterpriseServices.Internal.</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Publish</font></span><font style="font-size: 12pt">();</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; p.GacRemove(mya.Location);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">catch</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Exception</font></span><font style="font-size: 12pt"> ex) {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Failed!&quot;</font></span><font style="font-size: 12pt">);</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(ex.ToString());</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt">}</font></font><br></pre>

<h2>InstallState</h2>

<p>Instalátor může být i podstatně sofistikovanější. Často vyžaduje mezi instalací a odinstalací uchovávání nějakých informací, potřebných pro uvedení počítače do původního stavu. Takové informace si v metodě <em>Install</em> můžete ukládat do kolekce <em>stateSaver</em>. Instalační utilita je potom serializuje do souboru, který se standardně jmenuje <em>JménoAssembly.InstallState</em>. V případě odinstalace se pak informace deserializují a dostanete je v rámci parametru <em>savedState</em> metody <em>Uninstall</em>.</p>

<p>Následující instalační třída slouží k registraci HTTP modulu na úrovni celého web serveru. Do install state si uloží jméno, pod kterým byl&#160; modul do konfigurace vložen:</p>

<p><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> System;</font></font> 

  <br><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> System.Collections;</font></font> 

  <br><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> Microsoft.Web.Administration;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">namespace</font></span><font style="font-size: 12pt"> Altairis.Web.OracleBugFix.Install {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">partial</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">class</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">HttpModuleInstaller</font></span><font style="font-size: 12pt"> : System.Configuration.Install.</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Installer</font></span><font style="font-size: 12pt"> {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Configuration properties</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">string</font></span><font style="font-size: 12pt"> ModuleName { </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">get</font></span><font style="font-size: 12pt">; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">set</font></span><font style="font-size: 12pt">; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Type</font></span><font style="font-size: 12pt"> ModuleType { </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">get</font></span><font style="font-size: 12pt">; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">set</font></span><font style="font-size: 12pt">; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Installer methods</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">override</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">void</font></span><font style="font-size: 12pt"> Install(</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">IDictionary</font></span><font style="font-size: 12pt"> stateSaver) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Base install tasks</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">base</font></span><font style="font-size: 12pt">.Install(stateSaver);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Validate properties</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">string</font></span><font style="font-size: 12pt">.IsNullOrEmpty(</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.ModuleName)) </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">throw</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ArgumentException</font></span><font style="font-size: 12pt">(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;ModuleName is null or empty.&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.ModuleType == </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">null</font></span><font style="font-size: 12pt">) </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">throw</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ArgumentNullException</font></span><font style="font-size: 12pt">(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;ModuleType&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">try</font></span><font style="font-size: 12pt"> {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Install module to IIS</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Loading server configuration...&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ServerManager</font></span><font style="font-size: 12pt"> serverManager = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ServerManager</font></span><font style="font-size: 12pt">()) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Configuration</font></span><font style="font-size: 12pt"> config = serverManager.GetApplicationHostConfiguration();</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationSection</font></span><font style="font-size: 12pt"> modulesSection = config.GetSection(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;system.webServer/modules&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationElementCollection</font></span><font style="font-size: 12pt"> modulesCollection = modulesSection.GetCollection();</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Installing module...&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationElement</font></span><font style="font-size: 12pt"> addElement = modulesCollection.CreateElement(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;add&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; addElement[</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;name&quot;</font></span><font style="font-size: 12pt">] = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.ModuleName;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; addElement[</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;type&quot;</font></span><font style="font-size: 12pt">] = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.ModuleType.AssemblyQualifiedName;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; modulesCollection.Add(addElement);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Saving changes...&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; serverManager.CommitChanges();</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Add module name to install state</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; stateSaver.Add(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;ModuleName&quot;</font></span><font style="font-size: 12pt">, </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.ModuleName);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">catch</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Exception</font></span><font style="font-size: 12pt"> ex) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Failed!&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(ex.ToString());</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">override</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">void</font></span><font style="font-size: 12pt"> Uninstall(</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">IDictionary</font></span><font style="font-size: 12pt"> savedState) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Base uninstall task</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">base</font></span><font style="font-size: 12pt">.Uninstall(savedState);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Load installed module name</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (savedState == </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">null</font></span><font style="font-size: 12pt">) </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">throw</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ArgumentNullException</font></span><font style="font-size: 12pt">(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;savedState&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">var</font></span><font style="font-size: 12pt"> moduleName = savedState[</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;ModuleName&quot;</font></span><font style="font-size: 12pt">] </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">as</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">string</font></span><font style="font-size: 12pt">;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">string</font></span><font style="font-size: 12pt">.IsNullOrEmpty(moduleName)) </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">throw</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ArgumentException</font></span><font style="font-size: 12pt">(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Module name not available in saved state.&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">try</font></span><font style="font-size: 12pt"> {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Loading server configuration...&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ServerManager</font></span><font style="font-size: 12pt"> serverManager = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ServerManager</font></span><font style="font-size: 12pt">()) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Configuration</font></span><font style="font-size: 12pt"> config = serverManager.GetApplicationHostConfiguration();</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationSection</font></span><font style="font-size: 12pt"> modulesSection = config.GetSection(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;system.webServer/modules&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationElementCollection</font></span><font style="font-size: 12pt"> modulesCollection = modulesSection.GetCollection();</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Uninstalling module...&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationElement</font></span><font style="font-size: 12pt"> element = FindElement(modulesCollection, </font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;add&quot;</font></span><font style="font-size: 12pt">, </font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;name&quot;</font></span><font style="font-size: 12pt">, moduleName);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (element == </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">null</font></span><font style="font-size: 12pt">) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Not found - no work to do&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">return</font></span><font style="font-size: 12pt">;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; modulesCollection.Remove(element);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.Write(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Saving changes...&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; serverManager.CommitChanges();</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;OK&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">catch</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Exception</font></span><font style="font-size: 12pt"> ex) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(</font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;Failed!&quot;</font></span><font style="font-size: 12pt">);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Console</font></span><font style="font-size: 12pt">.WriteLine(ex.ToString());</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Helper methods</font></span></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">private</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">static</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationElement</font></span><font style="font-size: 12pt"> FindElement(</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationElementCollection</font></span><font style="font-size: 12pt"> collection, </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">string</font></span><font style="font-size: 12pt"> elementTagName, </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">params</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">string</font></span><font style="font-size: 12pt">[] keyValues) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">foreach</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ConfigurationElement</font></span><font style="font-size: 12pt"> element </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">in</font></span><font style="font-size: 12pt"> collection) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">String</font></span><font style="font-size: 12pt">.Equals(element.ElementTagName, elementTagName, </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">StringComparison</font></span><font style="font-size: 12pt">.OrdinalIgnoreCase)) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">bool</font></span><font style="font-size: 12pt"> matches = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">true</font></span><font style="font-size: 12pt">;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">for</font></span><font style="font-size: 12pt"> (</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">int</font></span><font style="font-size: 12pt"> i = 0; i &lt; keyValues.Length; i += 2) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">object</font></span><font style="font-size: 12pt"> o = element.GetAttributeValue(keyValues[i]);</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">string</font></span><font style="font-size: 12pt"> value = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">null</font></span><font style="font-size: 12pt">;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (o != </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">null</font></span><font style="font-size: 12pt">) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; value = o.ToString();</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (!</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">String</font></span><font style="font-size: 12pt">.Equals(value, keyValues[i + 1], </font><span style="color: "><font style="font-size: 12pt" color="#2b91af">StringComparison</font></span><font style="font-size: 12pt">.OrdinalIgnoreCase)) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; matches = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">false</font></span><font style="font-size: 12pt">;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">break</font></span><font style="font-size: 12pt">;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">if</font></span><font style="font-size: 12pt"> (matches) {</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">return</font></span><font style="font-size: 12pt"> element;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">return</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">null</font></span><font style="font-size: 12pt">;</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt"></font></font>

  <br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160; }</font></font> 

  <br><font face="Consolas"><font style="font-size: 12pt">}</font></font> </p>

<h2>Vestavěné instalátory</h2>

<p>Výše uvedené instalátory jsou vcelku univerzální a můžete je snadno níže popsaným způsobem použít ve svých aplikacích. Součástí .NET Frameworku jsou již některé hotové instalátory:</p>

<ul>
  <li><a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.eventloginstaller.aspx">System.Diagnostics.EventLogInstaller</a> – vytváří nový protokol událostí (event log), případně nový zdroj (source) pro existující log. </li>

  <li><a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.performancecounterinstaller.aspx">System.Diagnostics.PerformanceCounterInstaller</a>&#160; – vytváří performance countery (pro sledování výkonu a vytížení serveru) </li>

  <li><a href="http://msdn.microsoft.com/en-us/library/system.messaging.messagequeueinstaller.aspx">System.Messaging.MessageQueueInstaller</a> – vytváří novou frontu v rámci Message Queuing Sevice </li>

  <li><a href="http://msdn.microsoft.com/en-us/library/system.serviceprocess.serviceinstaller.aspx">System.ServiceProcess.ServiceInstaller</a> – slouží k instalaci služby (Windows Service) </li>

  <li><a href="http://msdn.microsoft.com/en-us/library/system.serviceprocess.serviceprocessinstaller.aspx">System.ServiceProcess.ServiceProcessInstaller</a> – slouží k instalaci procesu, který může hostovat několik služeb </li>
</ul>

<h2>Spouštění instalátorů</h2>

<p><em>InstallUtil.exe</em> spustí jenom ty instalátory, jejichž třídy jsou označené atributem <em>[RunInstaller(true)]</em>. Pokud byste ve své aplikaci měli jenom instalátory vlastní výroby, s parametry napsanými přímo v kódu, mohli byste je prostě označit všechny. V praxi to není příliš dobrý nápad, už jenom proto, že činí znovupoužitelnost instalačních tříd dost komplikovanou.</p>

<p>Instalační třídy mohou fungovat hierarchicky. Třída <em>Installer</em> má kolekci <em>Installers</em>, která může obsahovat další instalátory, které se spustí, je-li spuštěn jejich mateřský. V praxi se tedy obvykle postupuje tak, že si v aplikaci vytvoříte jednu třídu, obvykle ji nazývám <em>ApplicationInstaller</em> a v jejím konstruktoru naplníte kolekci <em>Installers</em> všemi dalšími instalátory, které chcete spustit, přičemž jim při této příležitosti také předáte potřebné parametry. Pouze tuto jedinou třídu pak označíte jako <em>[RunInstaller(true)]</em>.</p>

<p>Následující kód ukazuje takovou třídu, která aktivuje oba dva výše popsané instalátory a jeden vestavěný, pro vytvoření vlastního event logu:</p>

<pre style="margin-top: auto; font-family: ; margin-bottom: auto"><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">using</font></span><font style="font-size: 12pt"> System.ComponentModel;</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><span style="color: "><font style="font-size: 12pt" color="#0000ff">namespace</font></span><font style="font-size: 12pt"> Altairis.Web.OracleBugFix.Install {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160; [</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">RunInstaller</font></span><font style="font-size: 12pt">(</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">true</font></span><font style="font-size: 12pt">)]</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">class</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ApplicationInstaller</font></span><font style="font-size: 12pt"> : System.Configuration.Install.</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">Installer</font></span><font style="font-size: 12pt"> {</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">public</font></span><font style="font-size: 12pt"> ApplicationInstaller() {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Add AssemblyGacInstaller</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.Installers.Add(</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">AssemblyGacInstaller</font></span><font style="font-size: 12pt">());</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Add HttpModuleInstaller</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.Installers.Add(</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt">&#160;</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">HttpModuleInstaller</font></span><font style="font-size: 12pt"> {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ModuleName = </font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;AltairisOracleBugFixErrorHandlingModule&quot;</font></span><font style="font-size: 12pt">,</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ModuleType = </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">typeof</font></span><font style="font-size: 12pt">(</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">ErrorHandlingModule</font></span><font style="font-size: 12pt">),</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; });</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#008000">// Add built-in event log installer</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font style="font-size: 12pt" color="#0000ff">this</font></span><font style="font-size: 12pt">.Installers.Add(</font><span style="color: "><font style="font-size: 12pt" color="#0000ff">new</font></span><font style="font-size: 12pt"> System.Diagnostics.</font><span style="color: "><font style="font-size: 12pt" color="#2b91af">EventLogInstaller</font></span><font style="font-size: 12pt"> {</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Log = </font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;MujLog&quot;</font></span><font style="font-size: 12pt">,</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Source = </font><span style="color: "><font style="font-size: 12pt" color="#a31515">&quot;MujSource&quot;</font></span></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; });</font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt"> </font></font><br><font face="Consolas"><font style="font-size: 12pt">&#160;&#160;&#160; }</font></font><br><font face="Consolas"><font style="font-size: 12pt">}</font></font></pre>